<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="mobile-web-app-capable" content="yes">
    <title>
        Database System Term Project - HackMD
    </title>
    <link rel="icon" type="image/png" href="https://hackmd.io/favicon.png">
    <link rel="apple-touch-icon" href="https://hackmd.io/apple-touch-icon.png">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css" integrity="sha256-3iu9jgsy9TpTwXKb7bNQzqWekRX7pPK+2OLj3R922fo=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/octicons/3.5.0/octicons.min.css" integrity="sha256-QiWfLIsCT02Sdwkogf6YMiQlj4NE84MKkzEMkZnMGdg=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.5.1/themes/prism.min.css" integrity="sha256-vtR0hSWRc3Tb26iuN2oZHt3KRUomwTufNIf5/4oeCyg=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@hackmd/emojify.js@2.1.0/dist/css/basic/emojify.min.css" integrity="sha256-UOrvMOsSDSrW6szVLe8ZDZezBxh5IoIfgTwdNDgTjiU=" crossorigin="anonymous" />
    <style>
        @import url(https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i|Source+Code+Pro:300,400,500|Source+Sans+Pro:300,300i,400,400i,600,600i|Source+Serif+Pro&subset=latin-ext);.hljs{background:#fff;color:#333;display:block;overflow-x:auto;padding:.5em}.hljs-comment,.hljs-meta{color:#969896}.hljs-emphasis,.hljs-quote,.hljs-string,.hljs-strong,.hljs-template-variable,.hljs-variable{color:#df5000}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#a71d5d}.hljs-attribute,.hljs-bullet,.hljs-literal,.hljs-number,.hljs-symbol{color:#0086b3}.hljs-built_in,.hljs-builtin-name{color:#005cc5}.hljs-name,.hljs-section{color:#63a35c}.hljs-tag{color:#333}.hljs-attr,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-title{color:#795da3}.hljs-addition{background-color:#eaffea;color:#55a532}.hljs-deletion{background-color:#ffecec;color:#bd2c00}.hljs-link{text-decoration:underline}.markdown-body{word-wrap:break-word;font-size:16px;line-height:1.5}.markdown-body:after,.markdown-body:before{content:"";display:table}.markdown-body:after{clear:both}.markdown-body>:first-child{margin-top:0!important}.markdown-body>:last-child{margin-bottom:0!important}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body .absent{color:#c00}.markdown-body .anchor{float:left;line-height:1;margin-left:-20px;padding-right:4px}.markdown-body .anchor:focus{outline:none}.markdown-body blockquote,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-bottom:16px;margin-top:0}.markdown-body hr{background-color:#e7e7e7;border:0;height:.25em;margin:24px 0;padding:0}.markdown-body blockquote{border-left:.25em solid #ddd;color:#777;font-size:16px;padding:0 1em}.markdown-body blockquote>:first-child{margin-top:0}.markdown-body blockquote>:last-child{margin-bottom:0}.markdown-body kbd,.popover kbd{background-color:#fcfcfc;border:1px solid;border-color:#ccc #ccc #bbb;border-radius:3px;box-shadow:inset 0 -1px 0 #bbb;color:#555;display:inline-block;font-size:11px;line-height:10px;padding:3px 5px;vertical-align:middle}.markdown-body .loweralpha{list-style-type:lower-alpha}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{font-weight:600;line-height:1.25;margin-bottom:16px;margin-top:24px}.markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link{color:#000;vertical-align:middle;visibility:hidden}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{text-decoration:none}.markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link{visibility:visible}.markdown-body h1 code,.markdown-body h1 tt,.markdown-body h2 code,.markdown-body h2 tt,.markdown-body h3 code,.markdown-body h3 tt,.markdown-body h4 code,.markdown-body h4 tt,.markdown-body h5 code,.markdown-body h5 tt,.markdown-body h6 code,.markdown-body h6 tt{font-size:inherit}.markdown-body h1{font-size:2em}.markdown-body h1,.markdown-body h2{border-bottom:1px solid #eee;padding-bottom:.3em}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.25em}.markdown-body h4{font-size:1em}.markdown-body h5{font-size:.875em}.markdown-body h6{color:#777;font-size:.85em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol.no-list,.markdown-body ul.no-list{list-style-type:none;padding:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-bottom:0;margin-top:0}.markdown-body li>p{margin-top:16px}.markdown-body li+li{padding-top:.25em}.markdown-body dl{padding:0}.markdown-body dl dt{font-size:1em;font-style:italic;font-weight:700;margin-top:16px;padding:0}.markdown-body dl dd{margin-bottom:16px;padding:0 16px}.markdown-body table{display:block;overflow:auto;width:100%;word-break:normal;word-break:keep-all}.markdown-body table th{font-weight:700}.markdown-body table td,.markdown-body table th{border:1px solid #ddd;padding:6px 13px}.markdown-body table tr{background-color:#fff;border-top:1px solid #ccc}.markdown-body table tr:nth-child(2n){background-color:#f8f8f8}.markdown-body img{background-color:#fff;box-sizing:initial;max-width:100%}.markdown-body img[align=right]{padding-left:20px}.markdown-body img[align=left]{padding-right:20px}.markdown-body .emoji{background-color:initial;max-width:none;vertical-align:text-top}.markdown-body span.frame{display:block;overflow:hidden}.markdown-body span.frame>span{border:1px solid #ddd;display:block;float:left;margin:13px 0 0;overflow:hidden;padding:7px;width:auto}.markdown-body span.frame span img{display:block;float:left}.markdown-body span.frame span span{clear:both;color:#333;display:block;padding:5px 0 0}.markdown-body span.align-center{clear:both;display:block;overflow:hidden}.markdown-body span.align-center>span{display:block;margin:13px auto 0;overflow:hidden;text-align:center}.markdown-body span.align-center span img{margin:0 auto;text-align:center}.markdown-body span.align-right{clear:both;display:block;overflow:hidden}.markdown-body span.align-right>span{display:block;margin:13px 0 0;overflow:hidden;text-align:right}.markdown-body span.align-right span img{margin:0;text-align:right}.markdown-body span.float-left{display:block;float:left;margin-right:13px;overflow:hidden}.markdown-body span.float-left span{margin:13px 0 0}.markdown-body span.float-right{display:block;float:right;margin-left:13px;overflow:hidden}.markdown-body span.float-right>span{display:block;margin:13px auto 0;overflow:hidden;text-align:right}.markdown-body code,.markdown-body tt{background-color:#0000000a;border-radius:3px;font-size:85%;margin:0;padding:.2em 0}.markdown-body code:after,.markdown-body code:before,.markdown-body tt:after,.markdown-body tt:before{content:"\00a0";letter-spacing:-.2em}.markdown-body code br,.markdown-body tt br{display:none}.markdown-body del code{text-decoration:inherit}.markdown-body pre{word-wrap:normal}.markdown-body pre>code{background:#0000;border:0;font-size:100%;margin:0;padding:0;white-space:pre;word-break:normal}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{background-color:#f7f7f7;border-radius:3px;font-size:85%;line-height:1.45;overflow:auto;padding:16px}.markdown-body pre code,.markdown-body pre tt{word-wrap:normal;background-color:initial;border:0;display:inline;line-height:inherit;margin:0;max-width:auto;overflow:visible;padding:0}.markdown-body pre code:after,.markdown-body pre code:before,.markdown-body pre tt:after,.markdown-body pre tt:before{content:normal}.markdown-body .csv-data td,.markdown-body .csv-data th{font-size:12px;line-height:1;overflow:hidden;padding:5px;text-align:left;white-space:nowrap}.markdown-body .csv-data .blob-line-num{background:#fff;border:0;padding:10px 8px 9px;text-align:right}.markdown-body .csv-data tr{border-top:0}.markdown-body .csv-data th{background:#f8f8f8;border-top:0;font-weight:700}.news .alert .markdown-body blockquote{border:0;padding:0 0 0 40px}.activity-tab .news .alert .commits,.activity-tab .news .markdown-body blockquote{padding-left:0}.task-list-item{list-style-type:none}.task-list-item label{font-weight:400}.task-list-item.enabled label{cursor:pointer}.task-list-item+.task-list-item{margin-top:3px}.task-list-item-checkbox{cursor:default!important;float:left;margin:.31em 0 .2em -1.3em!important;vertical-align:middle}.markdown-body{max-width:758px;overflow:visible!important;padding-bottom:40px;padding-top:40px;position:relative}.markdown-body .emoji{vertical-align:top}.markdown-body pre{border:inherit!important}.markdown-body code{color:inherit!important}.markdown-body pre code .wrapper{display:-moz-inline-flex;display:-ms-inline-flex;display:-o-inline-flex;display:inline-flex}.markdown-body pre code .gutter{float:left;overflow:hidden;-webkit-user-select:none;user-select:none}.markdown-body pre code .gutter.linenumber{border-right:3px solid #6ce26c!important;box-sizing:initial;color:#afafaf!important;cursor:default;display:inline-block;min-width:20px;padding:0 8px 0 0;position:relative;text-align:right;z-index:4}.markdown-body pre code .gutter.linenumber>span:before{content:attr(data-linenumber)}.markdown-body pre code .code{float:left;margin:0 0 0 16px}.markdown-body .gist .line-numbers{border-bottom:none;border-left:none;border-top:none}.markdown-body .gist .line-data{border:none}.markdown-body .gist table{border-collapse:inherit!important;border-spacing:0}.markdown-body code[data-gist-id]{background:none;padding:0}.markdown-body code[data-gist-id]:after,.markdown-body code[data-gist-id]:before{content:""}.markdown-body code[data-gist-id] .blob-num{border:unset}.markdown-body code[data-gist-id] table{margin-bottom:unset;overflow:unset}.markdown-body code[data-gist-id] table tr{background:unset}.markdown-body[dir=rtl] pre{direction:ltr}.markdown-body[dir=rtl] code{direction:ltr;unicode-bidi:embed}.markdown-body .alert>p:last-child{margin-bottom:0}.markdown-body pre.abc,.markdown-body pre.flow-chart,.markdown-body pre.graphviz,.markdown-body pre.mermaid,.markdown-body pre.sequence-diagram,.markdown-body pre.vega{background-color:inherit;border-radius:0;overflow:visible;text-align:center;white-space:inherit}.markdown-body pre.abc>code,.markdown-body pre.flow-chart>code,.markdown-body pre.graphviz>code,.markdown-body pre.mermaid>code,.markdown-body pre.sequence-diagram>code,.markdown-body pre.vega>code{text-align:left}.markdown-body pre.abc>svg,.markdown-body pre.flow-chart>svg,.markdown-body pre.graphviz>svg,.markdown-body pre.mermaid>svg,.markdown-body pre.sequence-diagram>svg,.markdown-body pre.vega>svg{height:100%;max-width:100%}.markdown-body pre>code.wrap{word-wrap:break-word;white-space:pre-wrap;white-space:-moz-pre-wrap;white-space:-pre-wrap;white-space:-o-pre-wrap}.markdown-body .alert>p:last-child,.markdown-body .alert>ul:last-child{margin-bottom:0}.markdown-body summary{display:list-item}.markdown-body summary:focus{outline:none}.markdown-body details summary{cursor:pointer}.markdown-body details:not([open])>:not(summary){display:none}.markdown-body figure{margin:1em 40px}.markdown-body .mark,.markdown-body mark{background-color:#fff1a7}.vimeo,.youtube{background-color:#000;background-position:50%;background-repeat:no-repeat;background-size:contain;cursor:pointer;display:table;overflow:hidden;text-align:center}.vimeo,.youtube{position:relative;width:100%}.youtube{padding-bottom:56.25%}.vimeo img{object-fit:contain;width:100%;z-index:0}.youtube img{object-fit:cover;z-index:0}.vimeo iframe,.youtube iframe,.youtube img{height:100%;left:0;position:absolute;top:0;width:100%}.vimeo iframe,.youtube iframe{vertical-align:middle;z-index:1}.vimeo .icon,.youtube .icon{color:#fff;height:auto;left:50%;opacity:.3;position:absolute;top:50%;transform:translate(-50%,-50%);transition:opacity .2s;width:auto;z-index:0}.vimeo:hover .icon,.youtube:hover .icon{opacity:.6;transition:opacity .2s}.slideshare .inner,.speakerdeck .inner{position:relative;width:100%}.slideshare .inner iframe,.speakerdeck .inner iframe{bottom:0;height:100%;left:0;position:absolute;right:0;top:0;width:100%}.figma{display:table;padding-bottom:56.25%;position:relative;width:100%}.figma iframe{border:1px solid #eee;bottom:0;height:100%;left:0;position:absolute;right:0;top:0;width:100%}.markmap-container{height:300px}.markmap-container>svg{height:100%;width:100%}.MJX_Assistive_MathML{display:none}#MathJax_Message{z-index:1000!important}.ui-infobar{color:#777;margin:25px auto -25px;max-width:760px;position:relative;z-index:2}.toc .invisable-node{list-style-type:none}.ui-toc{bottom:20px;position:fixed;z-index:998}.ui-toc.both-mode{margin-left:8px}.ui-toc.both-mode .ui-toc-label{border-bottom-left-radius:0;border-top-left-radius:0;height:40px;padding:10px 4px}.ui-toc-label{background-color:#e6e6e6;border:none;color:#868686;transition:opacity .2s}.ui-toc .open .ui-toc-label{color:#fff;opacity:1;transition:opacity .2s}.ui-toc-label:focus{background-color:#ccc;color:#000;opacity:.3}.ui-toc-label:hover{background-color:#ccc;opacity:1;transition:opacity .2s}.ui-toc-dropdown{margin-bottom:20px;margin-top:20px;max-height:70vh;max-width:45vw;overflow:auto;padding-left:10px;padding-right:10px;text-align:inherit;width:25vw}.ui-toc-dropdown>.toc{max-height:calc(70vh - 100px);overflow:auto}.ui-toc-dropdown[dir=rtl] .nav{letter-spacing:.0029em;padding-right:0}.ui-toc-dropdown a{overflow:hidden;text-overflow:ellipsis;white-space:pre}.ui-toc-dropdown .nav>li>a{color:#767676;display:block;font-size:13px;font-weight:500;padding:4px 20px}.ui-toc-dropdown .nav>li:first-child:last-child>ul,.ui-toc-dropdown .toc.expand ul{display:block}.ui-toc-dropdown .nav>li>a:focus,.ui-toc-dropdown .nav>li>a:hover{background-color:initial;border-left:1px solid #000;color:#000;padding-left:19px;text-decoration:none}.ui-toc-dropdown[dir=rtl] .nav>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav>li>a:hover{border-left:none;border-right:1px solid #000;padding-right:19px}.ui-toc-dropdown .nav>.active:focus>a,.ui-toc-dropdown .nav>.active:hover>a,.ui-toc-dropdown .nav>.active>a{background-color:initial;border-left:2px solid #000;color:#000;font-weight:700;padding-left:18px}.ui-toc-dropdown[dir=rtl] .nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav>.active>a{border-left:none;border-right:2px solid #000;padding-right:18px}.ui-toc-dropdown .nav .nav{display:none;padding-bottom:10px}.ui-toc-dropdown .nav>.active>ul{display:block}.ui-toc-dropdown .nav .nav>li>a{font-size:12px;font-weight:400;padding-bottom:1px;padding-left:30px;padding-top:1px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>a{padding-right:30px}.ui-toc-dropdown .nav .nav>li>ul>li>a{font-size:12px;font-weight:400;padding-bottom:1px;padding-left:40px;padding-top:1px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a{padding-right:40px}.ui-toc-dropdown .nav .nav>li>a:focus,.ui-toc-dropdown .nav .nav>li>a:hover{padding-left:29px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav .nav>li>a:hover{padding-right:29px}.ui-toc-dropdown .nav .nav>li>ul>li>a:focus,.ui-toc-dropdown .nav .nav>li>ul>li>a:hover{padding-left:39px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a:hover{padding-right:39px}.ui-toc-dropdown .nav .nav>.active:focus>a,.ui-toc-dropdown .nav .nav>.active:hover>a,.ui-toc-dropdown .nav .nav>.active>a{font-weight:500;padding-left:28px}.ui-toc-dropdown[dir=rtl] .nav .nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>a{padding-right:28px}.ui-toc-dropdown .nav .nav>.active>.nav>.active:focus>a,.ui-toc-dropdown .nav .nav>.active>.nav>.active:hover>a,.ui-toc-dropdown .nav .nav>.active>.nav>.active>a{font-weight:500;padding-left:38px}.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active>a{padding-right:38px}.markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html[lang^=ja] .markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ ゴシック,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html[lang=zh-tw] .markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html[lang=zh-cn] .markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html .markdown-body[lang^=ja]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ ゴシック,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html .markdown-body[lang=zh-tw]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html .markdown-body[lang=zh-cn]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Helvetica,Roboto,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}html[lang^=ja] .ui-toc-dropdown{font-family:Source Sans Pro,Helvetica,Arial,Meiryo UI,MS PGothic,ＭＳ Ｐゴシック,sans-serif}html[lang=zh-tw] .ui-toc-dropdown{font-family:Source Sans Pro,Helvetica,Arial,Microsoft JhengHei UI,微軟正黑UI,sans-serif}html[lang=zh-cn] .ui-toc-dropdown{font-family:Source Sans Pro,Helvetica,Arial,Microsoft YaHei UI,微软雅黑UI,sans-serif}html .ui-toc-dropdown[lang^=ja]{font-family:Source Sans Pro,Helvetica,Arial,Meiryo UI,MS PGothic,ＭＳ Ｐゴシック,sans-serif}html .ui-toc-dropdown[lang=zh-tw]{font-family:Source Sans Pro,Helvetica,Arial,Microsoft JhengHei UI,微軟正黑UI,sans-serif}html .ui-toc-dropdown[lang=zh-cn]{font-family:Source Sans Pro,Helvetica,Arial,Microsoft YaHei UI,微软雅黑UI,sans-serif}.ui-affix-toc{max-height:70vh;max-width:15vw;overflow:auto;position:fixed;top:0}.back-to-top,.expand-toggle,.go-to-bottom{color:#999;display:block;font-size:12px;font-weight:500;margin-left:10px;margin-top:10px;padding:4px 10px}.back-to-top:focus,.back-to-top:hover,.expand-toggle:focus,.expand-toggle:hover,.go-to-bottom:focus,.go-to-bottom:hover{color:#563d7c;text-decoration:none}.back-to-top,.go-to-bottom{margin-top:0}.ui-user-icon{background-position:50%;background-repeat:no-repeat;background-size:cover;border-radius:50%;display:block;height:20px;margin-bottom:2px;margin-right:5px;margin-top:2px;width:20px}.ui-user-icon.small{display:inline-block;height:18px;margin:0 0 .2em;vertical-align:middle;width:18px}.ui-infobar>small>span{line-height:22px}.ui-infobar>small .dropdown{display:inline-block}.ui-infobar>small .dropdown a:focus,.ui-infobar>small .dropdown a:hover{text-decoration:none}.ui-more-info{color:#888;cursor:pointer;vertical-align:middle}.ui-more-info .fa{font-size:16px}.ui-connectedGithub,.ui-published-note{color:#888}.ui-connectedGithub{line-height:23px;white-space:nowrap}.ui-connectedGithub a.file-path{color:#888;padding-left:22px;text-decoration:none}.ui-connectedGithub a.file-path:active,.ui-connectedGithub a.file-path:hover{color:#888;text-decoration:underline}.ui-connectedGithub .fa{font-size:20px}.ui-published-note .fa{font-size:20px;vertical-align:top}.unselectable{-webkit-user-select:none;-o-user-select:none;user-select:none}.selectable{-webkit-user-select:text;-o-user-select:text;user-select:text}.inline-spoiler-section{cursor:pointer}.inline-spoiler-section .spoiler-text{background-color:#333;border-radius:2px}.inline-spoiler-section .spoiler-text>*{opacity:0}.inline-spoiler-section .spoiler-img{filter:blur(10px)}.inline-spoiler-section.raw{background-color:#333;border-radius:2px}.inline-spoiler-section.raw>*{opacity:0}.inline-spoiler-section.unveil{cursor:auto}.inline-spoiler-section.unveil .spoiler-text{background-color:#3333331a}.inline-spoiler-section.unveil .spoiler-text>*{opacity:1}.inline-spoiler-section.unveil .spoiler-img{filter:none}@media print{blockquote,div,img,pre,table{page-break-inside:avoid!important}a[href]:after{font-size:12px!important}}.markdown-body.slides{color:#222;position:relative;z-index:1}.markdown-body.slides:before{background-color:currentColor;bottom:0;box-shadow:0 0 0 50vw;content:"";display:block;left:0;position:absolute;right:0;top:0;z-index:-1}.markdown-body.slides section[data-markdown]{background-color:#fff;margin-bottom:1.5em;position:relative;text-align:center}.markdown-body.slides section[data-markdown] code{text-align:left}.markdown-body.slides section[data-markdown]:before{content:"";display:block;padding-bottom:56.23%}.markdown-body.slides section[data-markdown]>div:first-child{left:1em;max-height:100%;overflow:hidden;position:absolute;right:1em;top:50%;transform:translateY(-50%)}.markdown-body.slides section[data-markdown]>ul{display:inline-block}.markdown-body.slides>section>section+section:after{border:3px solid #777;content:"";height:1.5em;position:absolute;right:1em;top:-1.5em}.site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,sans-serif}html[lang^=ja] .site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ ゴシック,sans-serif}html[lang=zh-tw] .site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif}html[lang=zh-cn] .site-ui-font{font-family:Source Sans Pro,Helvetica,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif}body{font-smoothing:subpixel-antialiased!important;-webkit-font-smoothing:subpixel-antialiased!important;-moz-osx-font-smoothing:auto!important;-webkit-overflow-scrolling:touch;font-family:Source Sans Pro,Helvetica,Arial,sans-serif;letter-spacing:.025em}html[lang^=ja] body{font-family:Source Sans Pro,Helvetica,Arial,Hiragino Kaku Gothic Pro,ヒラギノ角ゴ Pro W3,Osaka,Meiryo,メイリオ,MS Gothic,ＭＳ ゴシック,sans-serif}html[lang=zh-tw] body{font-family:Source Sans Pro,Helvetica,Arial,PingFang TC,Microsoft JhengHei,微軟正黑,sans-serif}html[lang=zh-cn] body{font-family:Source Sans Pro,Helvetica,Arial,PingFang SC,Microsoft YaHei,微软雅黑,sans-serif}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}abbr[data-original-title],abbr[title]{cursor:help}body.modal-open{overflow-y:auto;padding-right:0!important}svg{text-shadow:none}
    </style>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    	<script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js" integrity="sha256-3Jy/GbSLrg0o9y5Z5n1uw0qxZECH7C6OQpVBgNFYa0g=" crossorigin="anonymous"></script>
    	<script src="https://cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.min.js" integrity="sha256-g6iAfvZp+nDQ2TdTR/VVKJf3bGro4ub5fvWSWVRi2NE=" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.9/es5-shim.min.js" integrity="sha256-8E4Is26QH0bD52WoQpcB+R/tcWQtpzlCojrybUd7Mxo=" crossorigin="anonymous"></script>
    <![endif]-->
</head>

<body>
    <div class="container">
        <nav class="nav py-3 h4">
            <a class="nav-link active" href="/dinner/index.php">Home Page</a>
            <a class="nav-link" href="/report.html">Report</a>
            <a class="nav-link" href="/figure.html">Diagrams</a>

        </nav>
    </div>
    <div id="doc" class="markdown-body container-fluid comment-inner comment-enabled" data-hard-breaks="true"><p><span class="toc"><ul>

<li><a href="#Database-System-Term-Project" title="Database System Term Project">Database System Term Project</a><ul>
<li><a href="#Intro" title="Intro">Intro</a></li>
</ul>
</li>
<li><a href="#Setting-up-environment" title="Setting up environment">Setting up environment</a><ul>
<li><a href="#Basic-PHP-with-docker" title="Basic PHP with docker">Basic PHP with docker</a></li>
<li><a href="#Build-our-mysql-environment-through-docker-expose" title="Build our mysql environment through docker-expose">Build our mysql environment through docker-expose</a></li>
<li><a href="#Add-phpmyadmin-to-the-environment-and-testing-SQL-queries" title="Add phpmyadmin to the environment and testing SQL queries">Add phpmyadmin to the environment and testing SQL queries</a></li>
</ul>
</li>
<li><a href="#Constructing-PHP-part" title="Constructing PHP part">Constructing PHP part</a><ul>
<li><a href="#Auth--Database" title="Auth : Database">Auth : Database</a><ul>
<li><a href="#Database-with-user-data" title="Database with user data">Database with user data</a></li>
</ul>
</li>
<li><a href="#Auth--Register" title="Auth : Register">Auth : Register</a><ul>
<li><a href="#Basic-form-and-POST" title="Basic form and POST">Basic form and POST</a></li>
<li><a href="#Check-with-field-data" title="Check with field data">Check with field data</a></li>
<li><a href="#Check-exsitance-of-data-in-database" title="Check exsitance of data in database">Check exsitance of data in database</a></li>
<li><a href="#Provide-basic-security-of-password-with-hash" title="Provide basic security of password with hash">Provide basic security of password with hash</a></li>
</ul>
</li>
<li><a href="#Auth--Login" title="Auth : Login">Auth : Login</a><ul>
<li><a href="#A-basic-Login-page" title="A basic Login page">A basic Login page</a></li>
<li><a href="#Verify-with-hashed-password" title="Verify with hashed password">Verify with hashed password</a></li>
<li><a href="#Sessions-to-stay-login" title="Sessions to stay login">Sessions to stay login</a></li>
<li><a href="#Redirect-page-by-login-session" title="Redirect page by login session">Redirect page by login session</a></li>
<li><a href="#To-prevent-SQL-injections" title="To prevent SQL injections">To prevent SQL injections</a></li>
</ul>
</li>
<li><a href="#Dinner-CRUD" title="Dinner CRUD">Dinner CRUD</a><ul>
<li><a href="#Dinner-amp-Tag-Schema" title="Dinner &amp; Tag Schema">Dinner &amp; Tag Schema</a></li>
<li><a href="#A-basic-Dinner-Object" title="A basic Dinner Object">A basic Dinner Object</a></li>
<li><a href="#Create" title="Create">Create</a></li>
<li><a href="#Read" title="Read">Read</a></li>
<li><a href="#Update" title="Update">Update</a></li>
<li><a href="#Delete" title="Delete">Delete</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</span></p><h1 id="Database-System-Term-Project" data-id="Database-System-Term-Project"><a class="anchor hidden-xs" href="#Database-System-Term-Project" title="Database-System-Term-Project"><span class="octicon octicon-link"></span></a><span>Database System Term Project</span></h1><h2 id="Intro" data-id="Intro"><a class="anchor hidden-xs" href="#Intro" title="Intro"><span class="octicon octicon-link"></span></a><span>Intro</span></h2><p><span>In order to containerize our application and make it easy to develope and deploy, we would use docker to prepare the enrionment in this project.</span></p><p><span>We omit the trival docker install part in this report due to my docker already installed in my local in the time I start this project.</span></p><p><a href="https://www.section.io/engineering-education/dockerized-php-apache-and-mysql-container-development-environment/" target="_blank" rel="noopener"><span>Dockerized php apache and mysql container</span></a></p><h1 id="Setting-up-environment" data-id="Setting-up-environment"><a class="anchor hidden-xs" href="#Setting-up-environment" title="Setting-up-environment"><span class="octicon octicon-link"></span></a><span>Setting up environment</span></h1><h2 id="Basic-PHP-with-docker" data-id="Basic-PHP-with-docker"><a class="anchor hidden-xs" href="#Basic-PHP-with-docker" title="Basic-PHP-with-docker"><span class="octicon octicon-link"></span></a><span>Basic PHP with docker</span></h2><p><span>By define </span><code>docker-compose.yml</code><span>, we can use docker-compose to start docker container and bind the volumes in container to our disk.</span><br>
<span>We export the apache running port 80 to our host port 8000.</span></p><pre><code class="yaml hljs"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3.8'</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">php-apache-environment</span><span class="token punctuation">:</span>
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> php<span class="token punctuation">-</span>apache
    <span class="token key atrule">image</span><span class="token punctuation">:</span> php<span class="token punctuation">:</span>8.0<span class="token punctuation">-</span>apache
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./php/src<span class="token punctuation">:</span>/var/www/html/
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> 8000<span class="token punctuation">:</span><span class="token number">80</span>
</code></pre><p><span>After execute </span><code>docker-compose up</code><span>, we can host up the php+Apache environmnet.</span></p><p><span>We use this basic php file to test the funcionality of environment.</span></p><pre><code class="html hljs"><span class="language-xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>

</span><span class="language-php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">echo</span> <span class="hljs-string">"Hello World!"</span>;
<span class="hljs-meta">?&gt;</span></span><span class="language-xml">

<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</span></code></pre><p><span>we would get a helloworld page like this.</span><br>
<img src="https://i.imgur.com/CLAZVox.png" alt="" loading="lazy"></p><h2 id="Build-our-mysql-environment-through-docker-expose" data-id="Build-our-mysql-environment-through-docker-expose"><a class="anchor hidden-xs" href="#Build-our-mysql-environment-through-docker-expose" title="Build-our-mysql-environment-through-docker-expose"><span class="octicon octicon-link"></span></a><span>Build our mysql environment through docker-expose</span></h2><p><span>we add following yml configuration in the </span><code>docker-compose.yml</code></p><pre><code class="yml hljs"><span class="hljs-symbol">  db:</span>
<span class="hljs-symbol">      container_name:</span> db
<span class="hljs-symbol">      image:</span> mysql
<span class="hljs-symbol">      restart:</span> always
<span class="hljs-symbol">      environment:</span>
<span class="hljs-symbol">          MYSQL_ROOT_PASSWORD:</span> MYSQL_ROOT_PASSWORD
<span class="hljs-symbol">          MYSQL_DATABASE:</span> MY_DATABASE
<span class="hljs-symbol">          MYSQL_USER:</span> MYSQL_USER
<span class="hljs-symbol">          MYSQL_PASSWORD:</span> MYSQL_PASSWORD
<span class="hljs-symbol">      ports:</span>
          - <span class="hljs-string">"9906:3306"</span>
</code></pre><p><span>Also we add a </span><code>./docker/Dockerfile</code><span> in the folder with </span><code>docker-compose.yml</code><span> to provide a custom image build.</span><br>
<span>In this dockerfile we build a image with </span><code>mysqli</code><span> extention installed on a </span><code>webdevops/php-apache</code><span> image on docker hub and upgrade the os system by the way.</span></p><pre><code>FROM php:8.0-apache
RUN docker-php-ext-install mysqli &amp;&amp; docker-php-ext-enable mysqli
RUN apt-get update &amp;&amp; apt-get upgrade -y
</code></pre><p><span>In order to support the custom image with dockerfile, we add </span><code>build:</code><span> in  </span><code>php-apache-environment</code><span>  section.</span><br>
<span>Docker-compose would start the container on this image build by the dockerfile now.</span></p><pre><code class="yml hljs">    php<span class="hljs-operator">-</span>apache<span class="hljs-operator">-</span>environment:
        container_name: php<span class="hljs-operator">-</span>apache
        build:
            context: ./php
            dockerfile: Dockerfile
        depends_on:
            <span class="hljs-operator">-</span> db
        volumes:
            <span class="hljs-operator">-</span> ./php<span class="hljs-operator">/</span>src:<span class="hljs-operator">/</span><span class="hljs-keyword">var</span><span class="hljs-operator">/</span>www<span class="hljs-operator">/</span>html<span class="hljs-operator">/</span>
        ports:
            <span class="hljs-operator">-</span> <span class="hljs-number">8000</span>:<span class="hljs-number">80</span>
</code></pre><p><span>After built the environment, we can use </span><code>mysqli</code><span> in php to conect to mysql.</span></p><pre><code class="php hljs"><span class="hljs-comment">//These are the defined authentication environment in the db service</span>

<span class="hljs-comment">// The MySQL service named in the docker-compose.yml.</span>
<span class="hljs-variable">$host</span> = <span class="hljs-string">'db'</span>;

<span class="hljs-comment">// Database use name</span>
<span class="hljs-variable">$user</span> = <span class="hljs-string">'MYSQL_USER'</span>;

<span class="hljs-comment">//database user password</span>
<span class="hljs-variable">$pass</span> = <span class="hljs-string">'MYSQL_PASSWORD'</span>;

<span class="hljs-comment">// check the MySQL connection status</span>
<span class="hljs-variable">$conn</span> = <span class="hljs-keyword">new</span> mysqli(<span class="hljs-variable">$host</span>, <span class="hljs-variable">$user</span>, <span class="hljs-variable">$pass</span>);
<span class="hljs-keyword">if</span> (<span class="hljs-variable">$conn</span>-&gt;connect_error) {
    <span class="hljs-keyword">die</span>(<span class="hljs-string">"Connection failed: "</span> . <span class="hljs-variable">$conn</span>-&gt;connect_error);
} <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">echo</span> <span class="hljs-string">"Connected to MySQL server successfully!"</span>;
}
</code></pre><p><span>We can get a result on our </span><code>index.php</code><span> page like this to confirm the connection from php to mysql is successful.</span><br>
<img src="https://i.imgur.com/FyV91nz.png" alt="" loading="lazy"></p><h2 id="Add-phpmyadmin-to-the-environment-and-testing-SQL-queries" data-id="Add-phpmyadmin-to-the-environment-and-testing-SQL-queries"><a class="anchor hidden-xs" href="#Add-phpmyadmin-to-the-environment-and-testing-SQL-queries" title="Add-phpmyadmin-to-the-environment-and-testing-SQL-queries"><span class="octicon octicon-link"></span></a><span>Add </span><code>phpmyadmin</code><span> to the environment and testing SQL queries</span></h2><pre><code class="yml hljs">  <span class="hljs-attribute">phpmyadmin</span><span class="hljs-punctuation">:</span>
      <span class="hljs-attribute">image</span><span class="hljs-punctuation">:</span> <span class="hljs-string">phpmyadmin/phpmyadmin</span>
      <span class="hljs-attribute">ports</span><span class="hljs-punctuation">:</span>
          <span class="hljs-bullet">-</span> <span class="hljs-string">'9907:80'</span>
      <span class="hljs-attribute">restart</span><span class="hljs-punctuation">:</span> <span class="hljs-string">always</span>
      <span class="hljs-attribute">environment</span><span class="hljs-punctuation">:</span>
          <span class="hljs-attribute">PMA_HOST</span><span class="hljs-punctuation">:</span> <span class="hljs-string">db</span>
      <span class="hljs-attribute">depends_on</span><span class="hljs-punctuation">:</span>
          <span class="hljs-bullet">-</span> <span class="hljs-string">db</span>
</code></pre><p><span>We can connect to phpmyadmin through </span><a href="" target="_blank" rel="noopener"><span>127.0.0.1:9907</span></a></p><p><span>The username of phpmyadmin is </span><code>root</code><span> and the password is </span><code>MYSQL_ROOT_PASSWORD</code><span> variable we set in </span><code>docker-compose.yml</code><span>.</span></p><p><span>We can type following SQL command in the SQL query section on site to test the functionality of mysql.</span></p><ol>
<li><span>Drop the ‘users’ table first if exists any.</span></li>
<li><span>Create a ‘users’ table with auto incremental primary key </span><code>id</code><span> and </span><code>username</code><span>, </span><code>password</code><span> field in text.</span></li>
<li><span>Add some rows in the table.</span></li>
</ol><pre><code class="sql hljs"><span class="hljs-keyword">drop</span> <span class="hljs-keyword">table</span> if <span class="hljs-keyword">exists</span> `users`;
<span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> `users` (
    id <span class="hljs-type">int</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> auto_increment,
    username text <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,
    password text <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,
    <span class="hljs-keyword">primary</span> key (id)
);
<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> `users` (username, password) <span class="hljs-keyword">values</span>
    ("admin","password"),
    ("Alice","this is my password"),
    ("Job","12345678");
</code></pre><p><img src="https://i.imgur.com/UlgusTa.png" alt="" loading="lazy"></p><p><span>We add extra database name in </span><code>mysqli</code><span> statement. And simply use </span><code>$result = $conn-&gt;query($sql)</code><span> to execute the SQL query storing result in </span><code>$result</code><span>. After that use </span><code>foreach</code><span> and </span><code>echo</code><span> to print out the result.</span></p><pre><code class="php hljs"><span class="hljs-comment">//These are the defined authentication environment in the db service</span>

<span class="hljs-comment">// The MySQL service named in the docker-compose.yml.</span>
<span class="hljs-variable">$host</span> = <span class="hljs-string">'db'</span>;
<span class="hljs-comment">// Database use name</span>
<span class="hljs-variable">$user</span> = <span class="hljs-string">'MYSQL_USER'</span>;
<span class="hljs-comment">//database user password</span>
<span class="hljs-variable">$pass</span> = <span class="hljs-string">'MYSQL_PASSWORD'</span>;
<span class="hljs-comment">// database name</span>
<span class="hljs-variable">$mydatabase</span> = <span class="hljs-string">'MY_DATABASE'</span>;
<span class="hljs-comment">// check the mysql connection status</span>

<span class="hljs-variable">$conn</span> = <span class="hljs-keyword">new</span> mysqli(<span class="hljs-variable">$host</span>, <span class="hljs-variable">$user</span>, <span class="hljs-variable">$pass</span>, <span class="hljs-variable">$mydatabase</span>);

<span class="hljs-comment">// select query</span>
<span class="hljs-variable">$sql</span> = <span class="hljs-string">'SELECT * FROM users'</span>;

<span class="hljs-keyword">if</span> (<span class="hljs-variable">$result</span> = <span class="hljs-variable">$conn</span>-&gt;query(<span class="hljs-variable">$sql</span>)) {
    <span class="hljs-keyword">while</span> (<span class="hljs-variable">$data</span> = <span class="hljs-variable">$result</span>-&gt;fetch_object()) {
        <span class="hljs-variable">$users</span>[] = <span class="hljs-variable">$data</span>;
    }
}

<span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$users</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$user</span>) {
    <span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br&gt;"</span>;
    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$user</span>-&gt;username . <span class="hljs-string">" "</span> . <span class="hljs-variable">$user</span>-&gt;password;
    <span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br&gt;"</span>;
}
</code></pre><p><img src="https://i.imgur.com/hs8vOPS.png" alt="" loading="lazy"></p><h1 id="Constructing-PHP-part" data-id="Constructing-PHP-part"><a class="anchor hidden-xs" href="#Constructing-PHP-part" title="Constructing-PHP-part"><span class="octicon octicon-link"></span></a><span>Constructing PHP part</span></h1><h2 id="Auth--Database" data-id="Auth--Database"><a class="anchor hidden-xs" href="#Auth--Database" title="Auth--Database"><span class="octicon octicon-link"></span></a><span>Auth : Database</span></h2><h3 id="Database-with-user-data" data-id="Database-with-user-data"><a class="anchor hidden-xs" href="#Database-with-user-data" title="Database-with-user-data"><span class="octicon octicon-link"></span></a><span>Database with user data</span></h3><p><img src="https://i.imgur.com/QzeZ2wC.png" alt="" loading="lazy"></p><p><span>To store the data of this web app, we create a database call </span><code>dinner_picker</code><span> in mysql.</span></p><p><span>The first table of this database is </span><code>user</code><span> table with following attributes:</span></p><ul>
<li><span>User id : unsigned int with auto increament which is also a </span><strong><span>primary key</span></strong></li>
<li><span>Username : varchar with max length 30 and </span><strong><span>cannot be null</span></strong></li>
<li><span>Password : varchar with max length 30 and </span><strong><span>cannot be null</span></strong></li>
<li><span>Email : varchar with max length 50 and </span><strong><span>cannot be null</span></strong></li>
<li><span>Register date : with CURRENT_TIMESTAMP when create the account.</span></li>
</ul><p><span>The SQL query to create the table is this</span></p><pre><code class="sql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> users (
  id <span class="hljs-type">INT</span>(<span class="hljs-number">6</span>) UNSIGNED AUTO_INCREMENT <span class="hljs-keyword">PRIMARY</span> KEY,
  username <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">30</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  password <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">90</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  email <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  reg_date <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>
)
</code></pre><p><span>Before we interact with database, we should create a account for this web app to access the db data.</span></p><p><span>We add a user named “web_basic_client” to operate the login and register function in phpmyadmin interface.</span><br>
<span>This user have permission with </span><code>SELECT</code><span> and </span><code>INSERT</code><span> to data table. We only grant very limit permissions for this user to prevent potential high privileges operation  by SQL injection like change admin password or exploit the vulnerability</span></p><p><span>of database itself.</span></p><p><img src="https://i.imgur.com/RodV2Gg.png" alt="" loading="lazy"></p><h2 id="Auth--Register" data-id="Auth--Register"><a class="anchor hidden-xs" href="#Auth--Register" title="Auth--Register"><span class="octicon octicon-link"></span></a><span>Auth : Register</span></h2><h3 id="Basic-form-and-POST" data-id="Basic-form-and-POST"><a class="anchor hidden-xs" href="#Basic-form-and-POST" title="Basic-form-and-POST"><span class="octicon octicon-link"></span></a><span>Basic form and POST</span></h3><p><span>We create a php file </span><code>/auth/register.php</code><span> to handle registering.</span><br>
<span>We write a simple form to get register data.</span></p><pre><code class="html hljs"><span class="hljs-operator">&lt;</span>h1<span class="hljs-operator">&gt;</span>This <span class="hljs-keyword">is</span> the Register page<span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span>h1<span class="hljs-operator">&gt;</span>

<span class="hljs-operator">&lt;</span>form  action<span class="hljs-operator">=</span><span class="hljs-string">"register.php"</span> method<span class="hljs-operator">=</span><span class="hljs-string">"post"</span><span class="hljs-operator">&gt;</span>
  Username: <span class="hljs-operator">&lt;</span>input <span class="hljs-keyword">type</span><span class="hljs-operator">=</span><span class="hljs-string">"text"</span> name<span class="hljs-operator">=</span><span class="hljs-string">"username"</span><span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>br<span class="hljs-operator">&gt;</span>
  Password: <span class="hljs-operator">&lt;</span>input <span class="hljs-keyword">type</span><span class="hljs-operator">=</span><span class="hljs-string">"password"</span> name<span class="hljs-operator">=</span><span class="hljs-string">"password"</span><span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>br<span class="hljs-operator">&gt;</span>
  Repeat Password: <span class="hljs-operator">&lt;</span>input <span class="hljs-keyword">type</span><span class="hljs-operator">=</span><span class="hljs-string">"password"</span> name<span class="hljs-operator">=</span><span class="hljs-string">"repeat_password"</span><span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>br<span class="hljs-operator">&gt;</span>
  Email: <span class="hljs-operator">&lt;</span>input <span class="hljs-keyword">type</span><span class="hljs-operator">=</span><span class="hljs-string">"text"</span> name<span class="hljs-operator">=</span><span class="hljs-string">"email"</span><span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span>br<span class="hljs-operator">&gt;</span>
  <span class="hljs-operator">&lt;</span>input <span class="hljs-keyword">type</span><span class="hljs-operator">=</span><span class="hljs-string">"submit"</span><span class="hljs-operator">&gt;</span>
<span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span>form<span class="hljs-operator">&gt;</span>

<span class="hljs-operator">&lt;</span>h1<span class="hljs-operator">&gt;</span>Your data<span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span>h1<span class="hljs-operator">&gt;</span>
</code></pre><p><span>use </span><code>$_POST</code><span> to get the POST request from the user filled form .</span></p><pre><code class="php hljs"><span class="hljs-keyword">echo</span> <span class="hljs-string">"username:"</span>.(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">"username"</span>]                ?? <span class="hljs-string">""</span> ).<span class="hljs-string">"&lt;br&gt;"</span>;
<span class="hljs-keyword">echo</span> <span class="hljs-string">"password:"</span>.(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">"password"</span>]                ?? <span class="hljs-string">""</span> ).<span class="hljs-string">"&lt;br&gt;"</span>;
<span class="hljs-keyword">echo</span> <span class="hljs-string">"repeat_password:"</span>.(<span class="hljs-variable">$POST</span>[<span class="hljs-string">"repeat_password"</span>]   ?? <span class="hljs-string">""</span> ).<span class="hljs-string">"&lt;br&gt;"</span>;
<span class="hljs-keyword">echo</span> <span class="hljs-string">"email:"</span>.(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">"email"</span>]                      ?? <span class="hljs-string">""</span> ).<span class="hljs-string">"&lt;br&gt;"</span>;

</code></pre><p><span>So our register page is look like this currently.</span><br>
<img src="https://i.imgur.com/yHG4Uu1.png" alt="" loading="lazy"></p><h3 id="Check-with-field-data" data-id="Check-with-field-data"><a class="anchor hidden-xs" href="#Check-with-field-data" title="Check-with-field-data"><span class="octicon octicon-link"></span></a><span>Check with field data</span></h3><p><span>We do the following check to our field data before send the data to database.</span></p><ul>
<li><span>Check the field </span><code>username</code><span> is empty or not</span></li>
<li><span>Check the field </span><code>password_1</code><span> and </span><code>password_2</code><span> is empty or not</span></li>
<li><span>Check the field </span><code>email</code><span> is empty or not</span></li>
<li><span>Check the </span><code>password_1</code><span> and </span><code>password_2</code><span> is equal(the same) or not.</span></li>
</ul><pre><code class="php hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">register_data_static_check</span>(<span class="hljs-params"><span class="hljs-variable">$username</span>, <span class="hljs-variable">$password_1</span>, <span class="hljs-variable">$password_2</span>, <span class="hljs-variable">$email</span></span>)</span>{
  
    <span class="hljs-variable">$define_error_msg</span>[<span class="hljs-string">"PASSWORD_NOT_MATCH"</span>] = <span class="hljs-string">"Password and Repeat Password didn't match."</span>;
    <span class="hljs-variable">$define_error_msg</span>[<span class="hljs-string">"PASSWORD_EMPTY"</span>] = <span class="hljs-string">"Password field is empty !"</span>;
    <span class="hljs-variable">$define_error_msg</span>[<span class="hljs-string">"USERNAME_EMPTY"</span>] = <span class="hljs-string">"Username field is empty !"</span>;
    <span class="hljs-variable">$define_error_msg</span>[<span class="hljs-string">"EMAIL_EMPTY"</span>] = <span class="hljs-string">"Email field is mepty !"</span>;

    <span class="hljs-variable">$error_msg</span> = <span class="hljs-string">""</span>;

    <span class="hljs-comment">// check empty</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$username</span>)){
        <span class="hljs-variable">$error_msg</span> = <span class="hljs-variable">$define_error_msg</span>[<span class="hljs-string">"USERNAME_EMPTY"</span>];
    }
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$password_1</span>) || <span class="hljs-keyword">empty</span>(<span class="hljs-variable">$password_2</span>)){
        <span class="hljs-variable">$error_msg</span> = <span class="hljs-variable">$define_error_msg</span>[<span class="hljs-string">"PASSWORD_EMPTY"</span>];
    }
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$email</span>)){
        <span class="hljs-variable">$error_msg</span> = <span class="hljs-variable">$define_error_msg</span>[<span class="hljs-string">"EMAIL_EMPTY"</span>];
    }

    <span class="hljs-comment">// check password match</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$password_1</span> != <span class="hljs-variable">$password_2</span>){
        <span class="hljs-variable">$error_msg</span> = <span class="hljs-variable">$define_error_msg</span>[<span class="hljs-string">"PASSWORD_NOT_MATCH"</span>];
    }

    <span class="hljs-keyword">return</span> <span class="hljs-variable">$error_msg</span>;
}
</code></pre><p><span>A sample of error message might look like this.</span><br>
<img src="https://i.imgur.com/0ILtWBs.png" alt="" loading="lazy"></p><h3 id="Check-exsitance-of-data-in-database" data-id="Check-exsitance-of-data-in-database"><a class="anchor hidden-xs" href="#Check-exsitance-of-data-in-database" title="Check-exsitance-of-data-in-database"><span class="octicon octicon-link"></span></a><span>Check exsitance of data in database</span></h3><p><span>We do following check before insert the user data into database.</span></p><ul>
<li><span>Check the username is exists or not.</span></li>
<li><span>Check the email is exists or not.</span></li>
</ul><p><span>After these checks are passed, we can finally insert the user data into the database.</span></p><pre><code class="php hljs"><span class="hljs-class"><span class="hljs-keyword">Class</span> <span class="hljs-title">Register</span></span>{

    <span class="hljs-keyword">private</span> <span class="hljs-variable">$conn</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-variable">$define_error_msg</span>;

    <span class="hljs-comment">// return 1 if the check passed.</span>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_checker_username_exists</span>(<span class="hljs-params"><span class="hljs-variable">$username</span></span>)</span>{

        <span class="hljs-variable">$sql</span> = sprintf(<span class="hljs-string">"SELECT username FROM users WHERE username = '%s'"</span> , <span class="hljs-variable">$username</span>);

        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$result</span> = <span class="hljs-keyword">$this</span>-&gt;conn-&gt;query(<span class="hljs-variable">$sql</span>)) {

            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$result</span>-&gt;num_rows &gt; <span class="hljs-number">0</span>) {

                <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;define_error_msg[<span class="hljs-string">"USERNAME_EXIST"</span>];
            }
        }
        <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
    }

    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_checker_email_exists</span>(<span class="hljs-params"><span class="hljs-variable">$email</span></span>)</span>{

        <span class="hljs-variable">$sql</span> = sprintf(<span class="hljs-string">"SELECT username FROM users WHERE email = '%s'"</span> , <span class="hljs-variable">$email</span>);

        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$result</span> = <span class="hljs-keyword">$this</span>-&gt;conn-&gt;query(<span class="hljs-variable">$sql</span>)) {

            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$result</span>-&gt;num_rows &gt; <span class="hljs-number">0</span>) {

                <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;define_error_msg[<span class="hljs-string">"EMAIL_EXIST"</span>];
            }
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;failed_msg;
    }
  
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_register</span>(<span class="hljs-params"><span class="hljs-variable">$username</span>, <span class="hljs-variable">$password</span>, <span class="hljs-variable">$email</span></span>)</span>{
        <span class="hljs-variable">$sql</span> = sprintf(<span class="hljs-string">"INSERT INTO users(username, password, email) VALUES('%s', '%s', '%s')"</span>,
                    <span class="hljs-variable">$username</span>, <span class="hljs-variable">$password</span>, <span class="hljs-variable">$email</span>);
  
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;conn-&gt;query(<span class="hljs-variable">$sql</span>) === <span class="hljs-literal">TRUE</span>){
            <span class="hljs-keyword">echo</span> <span class="hljs-keyword">$this</span>-&gt;sucessful_msg;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
    }
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">$this</span>-&gt;check_state = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">$this</span>-&gt;conn = connect_to_db();
  
        <span class="hljs-keyword">$this</span>-&gt;define_error_msg[<span class="hljs-string">"USERNAME_EXIST"</span>] = <span class="hljs-string">"Username is already exists."</span>;
        <span class="hljs-keyword">$this</span>-&gt;define_error_msg[<span class="hljs-string">"EMAIL_EXIST"</span>] = <span class="hljs-string">"Email is aleardy exists.."</span>;
        <span class="hljs-keyword">$this</span>-&gt;sucessful_msg = <span class="hljs-string">"Register Sucessfully !"</span>;
        <span class="hljs-keyword">$this</span>-&gt;failed_msg = <span class="hljs-string">"Register Failed by unknowed reason !"</span>; 
    }
</code></pre><p><span>A sample of error message may look like this.</span><br>
<img src="https://i.imgur.com/INsDKu6.png" alt="" loading="lazy"></p><h3 id="Provide-basic-security-of-password-with-hash" data-id="Provide-basic-security-of-password-with-hash"><a class="anchor hidden-xs" href="#Provide-basic-security-of-password-with-hash" title="Provide-basic-security-of-password-with-hash"><span class="octicon octicon-link"></span></a><span>Provide basic security of password with hash</span></h3><p><span>To prevent our databased get hacked and hacker can directly get all users’ password.</span><br>
<span>We can hashed the password before we sent the register request. The password in database is also store in hashed form,</span><br>
<span>so that even hacker can get the data in database. The hacker still have to crack the hashed password to get the clear password.</span></p><p><span>However, Man In The Middle (MITM) attack can still get the password in the request client sent. We would add TLS support after we publish the website later to pathc out this vulnerability.</span></p><p><span>We can change the </span><code>_register</code><span> function a little bit by adding the </span><code>password_hash()</code><span> function</span></p><pre><code class="php hljs"><span class="hljs-variable">$hashed_password</span> = password_hash(<span class="hljs-variable">$password</span>, PASSWORD_DEFAULT);

<span class="hljs-variable">$sql</span> = sprintf(<span class="hljs-string">"INSERT INTO users(username, password, email) VALUES('%s', '%s', '%s')"</span>,
            <span class="hljs-variable">$username</span>, <span class="hljs-variable">$hashed_password</span>, <span class="hljs-variable">$email</span>);
</code></pre><h2 id="Auth--Login" data-id="Auth--Login"><a class="anchor hidden-xs" href="#Auth--Login" title="Auth--Login"><span class="octicon octicon-link"></span></a><span>Auth : Login</span></h2><h3 id="A-basic-Login-page" data-id="A-basic-Login-page"><a class="anchor hidden-xs" href="#A-basic-Login-page" title="A-basic-Login-page"><span class="octicon octicon-link"></span></a><span>A basic Login page</span></h3><p><span>This class is similar to the </span><code>Register</code><span> class but without check function.</span><br>
<span>We select the password field by username in table and check the password is equal to the password user submited.</span></p><p><span>In these page, we only show the login is success or not without provide the detail error message.</span></p><p><span>Note: This exmaple still use unhashed password in database.</span></p><pre><code class="php hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Login</span></span>{

    <span class="hljs-keyword">private</span> <span class="hljs-variable">$conn</span>;

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-keyword">$this</span>-&gt;conn  = connect_to_db();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_login</span>(<span class="hljs-params"><span class="hljs-variable">$username</span>, <span class="hljs-variable">$password</span></span>)</span>{

        <span class="hljs-variable">$sql</span> = sprintf(<span class="hljs-string">"SELECT password FROM users WHERE username = '%s'"</span> , <span class="hljs-variable">$username</span>);

        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$result</span> = <span class="hljs-keyword">$this</span>-&gt;conn-&gt;query(<span class="hljs-variable">$sql</span>)) {

            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$result</span>-&gt;num_rows == <span class="hljs-number">1</span>) {

                <span class="hljs-variable">$fetched_password</span> = <span class="hljs-variable">$result</span>-&gt;fetch_assoc()[<span class="hljs-string">"password"</span>];
                <span class="hljs-keyword">if</span> (<span class="hljs-variable">$password</span> === <span class="hljs-variable">$fetched_password</span>){
                    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
                }
      
            }
        }

        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">login</span>(<span class="hljs-params"><span class="hljs-variable">$username</span>, <span class="hljs-variable">$password</span></span>)</span>{
        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;_login(<span class="hljs-variable">$username</span>, <span class="hljs-variable">$password</span>) === <span class="hljs-number">1</span>){
            <span class="hljs-keyword">return</span> <span class="hljs-string">"Logined!"</span>;
        }<span class="hljs-keyword">else</span>{
            <span class="hljs-keyword">return</span> <span class="hljs-string">"Login failed!"</span>;
        }
  
    }
}
</code></pre><h3 id="Verify-with-hashed-password" data-id="Verify-with-hashed-password"><a class="anchor hidden-xs" href="#Verify-with-hashed-password" title="Verify-with-hashed-password"><span class="octicon octicon-link"></span></a><span>Verify with hashed password</span></h3><p><span>with a little change, we can use </span><code>password_verify</code><span> instead of put password into where clause in SQL query.</span></p><pre><code class="php hljs"><span class="hljs-variable">$result_arr</span> = <span class="hljs-variable">$result</span>-&gt;fetch_array( MYSQLI_ASSOC);

<span class="hljs-keyword">if</span>(password_verify(<span class="hljs-variable">$password</span>, <span class="hljs-variable">$result_arr</span>[<span class="hljs-string">"password"</span>])){
  
    <span class="hljs-keyword">return</span> <span class="hljs-variable">$result_arr</span>[<span class="hljs-string">"id"</span>];
}
</code></pre><h3 id="Sessions-to-stay-login" data-id="Sessions-to-stay-login"><a class="anchor hidden-xs" href="#Sessions-to-stay-login" title="Sessions-to-stay-login"><span class="octicon octicon-link"></span></a><span>Sessions to stay login</span></h3><p><span>By create  Login_Session object in first part of our php code, we can </span><code>session_start();</code><span> and use member function to get user info in session.</span></p><pre><code class="php hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Login_Session</span></span>{

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)
    </span>{
        session_start();
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">set_to_login</span>(<span class="hljs-params"><span class="hljs-variable">$user</span>, <span class="hljs-variable">$id</span></span>)</span>{

        <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">'user'</span>] = <span class="hljs-variable">$user</span>;
        <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">'user_id'</span>] = <span class="hljs-variable">$id</span>;
    }
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_user</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">'user'</span>])){
  
            <span class="hljs-keyword">return</span> <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">'user'</span>];
        }
        <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
    }
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_user_id</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">'user_id'</span>])){
  
            <span class="hljs-keyword">return</span> <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">'user_id'</span>];
        }
        <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">set_to_logout</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-keyword">unset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">'user'</span>]);
        <span class="hljs-keyword">unset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">'user_id'</span>]);
    }
}
</code></pre><h3 id="Redirect-page-by-login-session" data-id="Redirect-page-by-login-session"><a class="anchor hidden-xs" href="#Redirect-page-by-login-session" title="Redirect-page-by-login-session"><span class="octicon octicon-link"></span></a><span>Redirect page by login session</span></h3><p><span>we define 2 function to do the page redirection.</span><br>
<span>First one is adding </span><code>Location</code><span> in header before any render &amp; output on the page.</span><br>
<span>Second one is using meta-header with page refresh to do redirection which is a little bit slower than the first one.</span></p><pre><code class="php hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">redirect</span>(<span class="hljs-params"><span class="hljs-variable">$url</span>, <span class="hljs-variable">$statusCode</span> = <span class="hljs-number">303</span></span>)
</span>{
    header(<span class="hljs-string">'Location: '</span> . <span class="hljs-variable">$url</span>, <span class="hljs-literal">true</span>, <span class="hljs-variable">$statusCode</span>);
    <span class="hljs-keyword">die</span>();
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">meta_redirect</span>(<span class="hljs-params"><span class="hljs-variable">$URL</span>= <span class="hljs-string">"/index.php"</span></span>)</span>{
    <span class="hljs-keyword">echo</span> sprintf(<span class="hljs-string">"&lt;meta http-equiv='refresh' content='0; URL=%s'&gt;"</span>, <span class="hljs-variable">$URL</span>);
}
</code></pre><p><span>After define our redirect function, we can check if the user has been record in session.</span><br>
<span>Redirecting the page if a logined user is trying to visit login or register page.</span></p><p><span>Exmaple: in </span><code>login.php</code><span> or </span><code>register.php</code></p><pre><code class="php hljs"><span class="hljs-variable">$login_session</span> = <span class="hljs-keyword">new</span> Login_Session();
<span class="hljs-keyword">if</span>(!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$login_session</span>-&gt;get_user())){
    redirect(<span class="hljs-string">"/index.php"</span>);
}
</code></pre><h3 id="To-prevent-SQL-injections" data-id="To-prevent-SQL-injections"><a class="anchor hidden-xs" href="#To-prevent-SQL-injections" title="To-prevent-SQL-injections"><span class="octicon octicon-link"></span></a><span>To prevent SQL injections</span></h3><h4 id="potential-vulnerabilities-from-SQL-injection" data-id="potential-vulnerabilities-from-SQL-injection"><a class="anchor hidden-xs" href="#potential-vulnerabilities-from-SQL-injection" title="potential-vulnerabilities-from-SQL-injection"><span class="octicon octicon-link"></span></a><span>potential vulnerabilities from SQL injection</span></h4><p><span>This is the code we validate the user credential in our login php file.</span></p><pre><code class="php hljs"><span class="hljs-variable">$sql</span> = sprintf(<span class="hljs-string">"SELECT username FROM users WHERE username = '%s'"</span> , <span class="hljs-variable">$username</span>);
</code></pre><p><span>We use a very common injection payload </span><code>' or 'x'='x</code><span> to bypass the authentication to get a logined sessionID to exploit other authenticated information.</span><br>
<img src="https://i.imgur.com/rawsr2f.png" alt="" loading="lazy"><br>
<img src="https://i.imgur.com/ORxleFr.png" alt="" loading="lazy"></p><p><span>With logined sessionID we can further dump out the system info and even the whole data table without credential of admin.</span></p><p><span>This is the system info we got from sql injection to our login page.</span><br>
<img src="https://i.imgur.com/qNAEt9X.png" alt="" loading="lazy"></p><p><span>We dump the whole </span><code>users</code><span> table by sql injection.</span><br>
<img src="https://i.imgur.com/IuCma8j.png" alt="" loading="lazy"></p><h4 id="Protection-to-the-authentication-system" data-id="Protection-to-the-authentication-system"><a class="anchor hidden-xs" href="#Protection-to-the-authentication-system" title="Protection-to-the-authentication-system"><span class="octicon octicon-link"></span></a><span>Protection to the authentication system</span></h4><p><span>A SQL query like this can easily operate auth-by-pass injection like </span><code>' or ''-'</code><span> or </span><code>' or 'x'='x</code></p><pre><code class="php hljs"><span class="hljs-variable">$sql</span> = sprintf(<span class="hljs-string">"SELECT id FROM users WHERE username = '%s', password = 'password'"</span> , <span class="hljs-variable">$username</span>, <span class="hljs-variable">$password</span>);
</code></pre><p><span>However, the modified version like this can be prevent the common auth-by-pass injection but not for any type of injections.</span></p><pre><code class="php hljs"><span class="hljs-variable">$sql</span> = sprintf(<span class="hljs-string">"SELECT id,password FROM users WHERE username = '%s'"</span> , ( <span class="hljs-variable">$username</span>));

<span class="hljs-keyword">if</span> (<span class="hljs-variable">$result</span> = <span class="hljs-keyword">$this</span>-&gt;conn-&gt;query(<span class="hljs-variable">$sql</span>)) {

    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$result</span>-&gt;num_rows == <span class="hljs-number">1</span>) {

            <span class="hljs-variable">$result_arr</span> = <span class="hljs-variable">$result</span>-&gt;fetch_array( MYSQLI_ASSOC);
    
            <span class="hljs-keyword">if</span>(password_verify(<span class="hljs-variable">$password</span>, <span class="hljs-variable">$result_arr</span>[<span class="hljs-string">"password"</span>])){
        
                <span class="hljs-keyword">return</span> <span class="hljs-variable">$result_arr</span>[<span class="hljs-string">"id"</span>];
            }
            ;
            <span class="hljs-comment">// return $result_arr[0];</span>
    
        }
  
  
}
</code></pre><p><code>mysqli_real_escape_string</code></p><h2 id="Dinner-CRUD" data-id="Dinner-CRUD"><a class="anchor hidden-xs" href="#Dinner-CRUD" title="Dinner-CRUD"><span class="octicon octicon-link"></span></a><span>Dinner CRUD</span></h2><h3 id="Dinner-amp-Tag-Schema" data-id="Dinner-amp-Tag-Schema"><a class="anchor hidden-xs" href="#Dinner-amp-Tag-Schema" title="Dinner-amp-Tag-Schema"><span class="octicon octicon-link"></span></a><span>Dinner &amp; Tag Schema</span></h3><p><img src="https://i.imgur.com/iMlXiON.png" alt="" loading="lazy"></p><pre><code class="sql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> dinner (
id <span class="hljs-type">INT</span>(<span class="hljs-number">6</span>) UNSIGNED AUTO_INCREMENT <span class="hljs-keyword">PRIMARY</span> KEY,
name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">30</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8mb4 <span class="hljs-keyword">COLLATE</span> utf8mb4_zh_0900_as_cs <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
author <span class="hljs-type">INT</span>(<span class="hljs-number">6</span>) ,
<span class="hljs-keyword">CONSTRAINT</span> DINNER_AUTHOR_ID_FK <span class="hljs-keyword">FOREIGN</span> KEY (author) <span class="hljs-keyword">REFERENCES</span> users(id) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">SET</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> CASCADE, 
create_date <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>
)
</code></pre><pre><code class="sql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> tag (
id <span class="hljs-type">INT</span>(<span class="hljs-number">6</span>) UNSIGNED AUTO_INCREMENT <span class="hljs-keyword">PRIMARY</span> KEY,
name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">30</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8mb4 <span class="hljs-keyword">COLLATE</span> utf8mb4_zh_0900_as_cs <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>
)
</code></pre><pre><code class="sql hljs"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> dinner_tag (
id <span class="hljs-type">INT</span>(<span class="hljs-number">10</span>) UNSIGNED AUTO_INCREMENT <span class="hljs-keyword">PRIMARY</span> KEY,
dinner <span class="hljs-type">INT</span>(<span class="hljs-number">6</span>) UNSIGNED <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
tag <span class="hljs-type">INT</span>(<span class="hljs-number">6</span>) UNSIGNED <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
<span class="hljs-keyword">FOREIGN</span> KEY (dinner) <span class="hljs-keyword">REFERENCES</span> dinner(id) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> CASCADE <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> CASCADE, 
<span class="hljs-keyword">FOREIGN</span> KEY (tag) <span class="hljs-keyword">REFERENCES</span> tag(id) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> CASCADE <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> CASCADE
)
</code></pre><h3 id="A-basic-Dinner-Object" data-id="A-basic-Dinner-Object"><a class="anchor hidden-xs" href="#A-basic-Dinner-Object" title="A-basic-Dinner-Object"><span class="octicon octicon-link"></span></a><span>A basic Dinner Object</span></h3><p><span>Connect to MySQL in Dinner class constructor.</span></p><pre><code class="php hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Dinner</span></span>{

	<span class="hljs-keyword">private</span> <span class="hljs-variable">$conn</span>;
	<span class="hljs-keyword">private</span> <span class="hljs-variable">$dinner_array</span>;
	
	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>{
		<span class="hljs-keyword">$this</span>-&gt;conn = connect_to_db();
	
	}

}
</code></pre><h3 id="Create" data-id="Create"><a class="anchor hidden-xs" href="#Create" title="Create"><span class="octicon octicon-link"></span></a><span>Create</span></h3><p><span>Here comes the first function, we insert the dinner name &amp; author into dinner table.</span></p><pre><code class="php hljs"><span class="hljs-comment">// return the inserted dinner id</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_insert_dinner</span>(<span class="hljs-params"><span class="hljs-variable">$dinner</span>, <span class="hljs-variable">$user</span></span>)</span>{
	
	<span class="hljs-variable">$sql</span> = sprintf(<span class="hljs-string">"INSERT INTO dinner (name, author) VALUES ('%s', '%s')"</span>, <span class="hljs-variable">$dinner</span>, <span class="hljs-variable">$user</span>);
	<span class="hljs-keyword">$this</span>-&gt;conn-&gt;query(<span class="hljs-variable">$sql</span>);

	<span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;conn-&gt;insert_id;
}
</code></pre><p><span>Later we insert tag into tag table. To prevent we insert the dulplicated rows we can check the tag if exists in tag table or not.</span></p><pre><code class="php hljs"><span class="hljs-comment">// this function always return a tag id</span>
<span class="hljs-comment">// if the tag is not exist, this function would insert that tag into database.</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">check_and_insert_tag</span>(<span class="hljs-params"><span class="hljs-variable">$tag</span></span>)</span>{

	<span class="hljs-variable">$sql</span> = sprintf(<span class="hljs-string">"SELECT id FROM tag WHERE name='%s'"</span>, <span class="hljs-variable">$tag</span> );
	<span class="hljs-variable">$result</span> = <span class="hljs-keyword">$this</span>-&gt;conn-&gt;query(<span class="hljs-variable">$sql</span>);

	<span class="hljs-keyword">if</span>(<span class="hljs-variable">$result</span>-&gt;num_rows &gt; <span class="hljs-number">0</span>){
	
		<span class="hljs-keyword">return</span> <span class="hljs-variable">$result</span>-&gt;fetch_array(MYSQLI_NUM)[<span class="hljs-number">0</span>];
	}

	<span class="hljs-variable">$sql</span> =sprintf(<span class="hljs-string">"INSERT INTO tag (name) VALUES ('%s')"</span>, <span class="hljs-variable">$tag</span> );
	<span class="hljs-keyword">$this</span>-&gt;conn-&gt;query(<span class="hljs-variable">$sql</span>);

	<span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;conn-&gt;insert_id;
}
</code></pre><p><span>But after I finished this function, I found we can use </span><code>INSERT IGNORE</code><span> to prevent dulplicates.</span></p><p><span>And we can build the dinner-tag relation to implement many-to-many relation.</span></p><pre><code class="php hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_insert_dinner_tag</span>(<span class="hljs-params"><span class="hljs-variable">$dinner</span>, <span class="hljs-variable">$tag</span></span>)</span>{

	<span class="hljs-variable">$sql</span> = sprintf(<span class="hljs-string">"INSERT INTO dinner_tag (dinner, tag) VALUES ('%s', '%s')"</span>, <span class="hljs-variable">$dinner</span>, <span class="hljs-variable">$tag</span>);

	<span class="hljs-keyword">$this</span>-&gt;conn-&gt;query(<span class="hljs-variable">$sql</span>);
}
</code></pre><p><span>Finally we can compose these sub-function to final insert_dinner function.</span></p><pre><code class="php hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">insert_dinner</span>(<span class="hljs-params"><span class="hljs-variable">$data</span></span>)</span>{

	<span class="hljs-comment">// insert dinner with user and name</span>
	<span class="hljs-variable">$dinner_id</span> = <span class="hljs-keyword">$this</span>-&gt;_insert_dinner(<span class="hljs-variable">$data</span>[<span class="hljs-string">"name"</span>], <span class="hljs-variable">$data</span>[<span class="hljs-string">"user"</span>]);

	<span class="hljs-comment">// insert dinner-tag with dinner id and tag id</span>
	<span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$data</span>[<span class="hljs-string">"tags"</span>] <span class="hljs-keyword">as</span> &amp;<span class="hljs-variable">$tag</span>){

		<span class="hljs-variable">$tag_id</span> = <span class="hljs-keyword">$this</span>-&gt;check_and_insert_tag(<span class="hljs-variable">$tag</span>);
		<span class="hljs-keyword">$this</span>-&gt;_insert_dinner_tag(<span class="hljs-variable">$dinner_id</span>, <span class="hljs-variable">$tag_id</span>);
	}
}
</code></pre><p><span>And we can use the </span><code>insert_dinner</code><span> function in </span><code>/dinner/insert.php</code><span>.</span><br>
<span>User can submit the insert form first and the PHP page gets POST request to start using </span><code>explode</code><span> and </span><code>implode</code><span> to process the tags string to tag array.</span></p><pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span>

<span class="hljs-keyword">include</span> <span class="hljs-string">'dinner.php'</span>;
<span class="hljs-keyword">include</span> <span class="hljs-string">'../auth/session.php'</span>;

<span class="hljs-variable">$login_session</span> = <span class="hljs-keyword">new</span> Login_Session();
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$login_session</span>-&gt;get_user())){
	redirect(<span class="hljs-string">"/auth/login.php"</span>);
}
<span class="hljs-meta">?&gt;</span>

  

&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
	&lt;title&gt;Create Dinner&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;Create!&lt;/h1&gt;
&lt;form action=<span class="hljs-string">"insert.php"</span> method=<span class="hljs-string">"post"</span>&gt;
	&lt;div&gt;
		&lt;span&gt;Dinner name &lt;/span&gt;&lt;input type=<span class="hljs-string">"text"</span> name=<span class="hljs-string">"name"</span> required&gt;
	&lt;/div&gt;
	&lt;div&gt;
		&lt;span&gt;Tages &lt;/span&gt;&lt;input type=<span class="hljs-string">"text"</span> name=<span class="hljs-string">"tags"</span>&gt;
	&lt;/div&gt;
		&lt;button type=<span class="hljs-string">"submit"</span> name=<span class="hljs-string">"submit"</span>&gt;Submit&lt;/button&gt;
&lt;/form&gt;

<span class="hljs-meta">&lt;?php</span>

	<span class="hljs-variable">$user</span> = <span class="hljs-variable">$login_session</span>-&gt;get_user();
	<span class="hljs-variable">$user_id</span> = <span class="hljs-variable">$login_session</span>-&gt;get_user_id();

	<span class="hljs-keyword">if</span>(<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$user</span>)){
		redirect(<span class="hljs-string">"/auth/login.php"</span>);
	}

	<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;h1&gt;Hi! User : "</span>. <span class="hljs-variable">$user</span>. <span class="hljs-string">" with id : "</span>. <span class="hljs-variable">$user_id</span> .<span class="hljs-string">"&lt;/h1&gt;"</span>;

	<span class="hljs-keyword">if</span> (!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_POST</span>)){
  
		<span class="hljs-variable">$tags</span> = explode(<span class="hljs-string">","</span>, <span class="hljs-variable">$_POST</span>[<span class="hljs-string">"tags"</span>]);
		<span class="hljs-variable">$tags</span> = array_map(<span class="hljs-string">'trim'</span>, <span class="hljs-variable">$tags</span>);
		<span class="hljs-keyword">echo</span> implode(<span class="hljs-string">' | '</span>, <span class="hljs-variable">$tags</span>);

		<span class="hljs-variable">$data</span> = <span class="hljs-keyword">array</span>(

			<span class="hljs-string">'name'</span> =&gt; <span class="hljs-variable">$_POST</span>[<span class="hljs-string">"name"</span>],
			<span class="hljs-string">'tags'</span> =&gt; <span class="hljs-variable">$tags</span>,
			<span class="hljs-string">'user'</span> =&gt; <span class="hljs-variable">$user_id</span>
		);

		<span class="hljs-variable">$dinner</span> = <span class="hljs-keyword">new</span> Dinner();
		<span class="hljs-variable">$dinner</span>-&gt;insert_dinner(<span class="hljs-variable">$data</span>);
		meta_redirect(<span class="hljs-string">"/dinner/index.php"</span>);
	}
<span class="hljs-meta">?&gt;</span>

&lt;/body&gt;
&lt;/html&gt;
</code></pre><p><img src="https://i.imgur.com/8JL77GH.png" alt="" loading="lazy"></p><h3 id="Read" data-id="Read"><a class="anchor hidden-xs" href="#Read" title="Read"><span class="octicon octicon-link"></span></a><span>Read</span></h3><p><span>We can get a array contains the name of tags queued by dinner id.</span></p><pre><code class="php hljs"><span class="hljs-comment">// return a array with strings </span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_tags</span>(<span class="hljs-params"><span class="hljs-variable">$dinner_id</span></span>)</span>{

	<span class="hljs-variable">$sql</span> = sprintf(<span class="hljs-string">"SELECT * FROM dinner_tag INNER JOIN tag ON dinner_tag.tag=tag.id WHERE dinner='%s' "</span>, <span class="hljs-variable">$dinner_id</span> );
	<span class="hljs-variable">$result</span> = <span class="hljs-keyword">$this</span>-&gt;conn-&gt;query(<span class="hljs-variable">$sql</span>);
	
	<span class="hljs-variable">$tags</span> = <span class="hljs-keyword">array</span>();
	<span class="hljs-keyword">if</span>(<span class="hljs-variable">$result</span>-&gt;num_rows &gt; <span class="hljs-number">0</span>){

		<span class="hljs-keyword">while</span>(<span class="hljs-variable">$row</span> = <span class="hljs-variable">$result</span>-&gt;fetch_assoc()){

			array_push(<span class="hljs-variable">$tags</span>, <span class="hljs-variable">$row</span>[<span class="hljs-string">"name"</span>]);
		}
	}

	<span class="hljs-keyword">return</span> <span class="hljs-variable">$tags</span>;
}
</code></pre><p><span>After that, we can use </span><code>JOIN</code><span> to combine dinner and users table to get username. Note the </span><code>LEFT JOIN</code><span> here to prevet there is null on dinner row so that we won’t miss some rows.</span></p><p><span>Instead return the array, we encode the dictionary to json to make the response more RESTful and decode it later.</span></p><pre><code class="php hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_dinners</span>(<span class="hljs-params"></span>)</span>{

	<span class="hljs-variable">$sql</span> = sprintf(<span class="hljs-string">"SELECT dinner.id, name, users.username, users.id as uid FROM dinner LEFT JOIN users ON dinner.author=users.id"</span> );
	<span class="hljs-variable">$result</span> = <span class="hljs-keyword">$this</span>-&gt;conn-&gt;query(<span class="hljs-variable">$sql</span>);

	<span class="hljs-variable">$result_dic</span> = <span class="hljs-keyword">array</span>();

	<span class="hljs-keyword">if</span>(<span class="hljs-variable">$result</span>-&gt;num_rows &gt; <span class="hljs-number">0</span>){

		<span class="hljs-variable">$result_array</span> = <span class="hljs-keyword">array</span>();
		<span class="hljs-keyword">while</span>(<span class="hljs-variable">$row</span> = <span class="hljs-variable">$result</span>-&gt;fetch_assoc()){

			<span class="hljs-variable">$tags</span> = <span class="hljs-keyword">$this</span>-&gt;get_tags(<span class="hljs-variable">$row</span>[<span class="hljs-string">"id"</span>]);
			<span class="hljs-variable">$row_result</span>[<span class="hljs-string">"id"</span>] = <span class="hljs-variable">$row</span>[<span class="hljs-string">"id"</span>];
			<span class="hljs-variable">$row_result</span>[<span class="hljs-string">"username"</span>] = <span class="hljs-variable">$row</span>[<span class="hljs-string">"username"</span>];
			<span class="hljs-variable">$row_result</span>[<span class="hljs-string">"dinner"</span>] = <span class="hljs-variable">$row</span>[<span class="hljs-string">"name"</span>];
			<span class="hljs-variable">$row_result</span>[<span class="hljs-string">"tags"</span>] = <span class="hljs-variable">$tags</span>;

			array_push(<span class="hljs-variable">$result_array</span>, <span class="hljs-variable">$row_result</span>);
		}
		<span class="hljs-variable">$result_dic</span>[<span class="hljs-string">'status'</span>] = <span class="hljs-string">"successful"</span>;
		<span class="hljs-variable">$result_dic</span>[<span class="hljs-string">'response'</span>] = <span class="hljs-variable">$result_array</span>;
		<span class="hljs-variable">$dinner_array</span> = <span class="hljs-variable">$result_array</span>;

	}<span class="hljs-keyword">else</span>{

		<span class="hljs-variable">$result_dic</span>[<span class="hljs-string">'status'</span>] = <span class="hljs-string">"fail or no result"</span>;
		<span class="hljs-variable">$result_dic</span>[<span class="hljs-string">'response'</span>] = <span class="hljs-string">""</span>;
	}

	<span class="hljs-comment">// encode array to json with utf8 support</span>
	<span class="hljs-variable">$response_json</span> = json_encode(<span class="hljs-variable">$result_dic</span>, JSON_UNESCAPED_UNICODE);
	<span class="hljs-keyword">return</span> <span class="hljs-variable">$response_json</span>;
}
</code></pre><p><span>Using the </span><code>foreach</code><span> to render each </span><code>&lt;tr&gt;</code><span> in table to dinner information.</span></p><pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span>

	<span class="hljs-keyword">include</span> <span class="hljs-string">'dinner.php'</span>;
	<span class="hljs-keyword">include</span> <span class="hljs-string">'../auth/session.php'</span>;

	<span class="hljs-variable">$login_session</span> = <span class="hljs-keyword">new</span> Login_Session();
	
	<span class="hljs-variable">$dinner</span> = <span class="hljs-keyword">new</span> Dinner();
	<span class="hljs-variable">$response</span> = <span class="hljs-variable">$dinner</span>-&gt;get_dinners();

	<span class="hljs-variable">$decoded</span> = json_decode(<span class="hljs-variable">$response</span>);
	<span class="hljs-variable">$status</span> = <span class="hljs-variable">$decoded</span>-&gt;status;
	<span class="hljs-variable">$data</span> = <span class="hljs-variable">$decoded</span>-&gt;response;
<span class="hljs-meta">?&gt;</span>

&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;

&lt;title&gt;Dinner&lt;/title&gt;

&lt;style&gt;
table, th, td {
	border: <span class="hljs-number">1</span>px solid black;
}
&lt;/style&gt;
&lt;/head&gt;

&lt;body&gt;

	&lt;h1&gt;Dinner!&lt;/h1&gt;

&lt;p&gt;&lt;a href=<span class="hljs-string">"/dinner/insert.php"</span>&gt;Insert a <span class="hljs-keyword">new</span> dinner&lt;/a&gt;&lt;/p&gt;

  
<span class="hljs-meta">&lt;?php</span>


	<span class="hljs-keyword">if</span>(!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$data</span>)){
		<span class="hljs-keyword">echo</span> <span class="hljs-string">"
		&lt;table&gt;
		&lt;tr&gt;
		&lt;th&gt;Dinner&lt;/th&gt;
		&lt;th&gt;Author&lt;/th&gt;
		&lt;th&gt;Tags&lt;/th&gt;
		&lt;/tr&gt;
		"</span>;

		<span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$data</span> <span class="hljs-keyword">as</span> &amp;<span class="hljs-variable">$d</span>){

			<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;tr&gt;"</span>;
			<span class="hljs-keyword">echo</span> sprintf(
			<span class="hljs-string">"
			&lt;td&gt;%s&lt;/td&gt;
			&lt;td&gt;%s&lt;/td&gt;
			&lt;td&gt;%s&lt;/td&gt;
			&lt;td&gt;%s %s&lt;/td&gt;
			"</span>,
			<span class="hljs-variable">$d</span>-&gt;dinner,
			<span class="hljs-variable">$d</span>-&gt;username,
			implode(<span class="hljs-string">", "</span>, <span class="hljs-variable">$d</span>-&gt;tags));
			<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;/tr&gt;"</span>;
		}
		<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;table&gt;"</span>;
	}<span class="hljs-keyword">else</span>{
	
		<span class="hljs-keyword">echo</span> <span class="hljs-string">"NO RESULT"</span>;
	}

	<span class="hljs-variable">$user</span> = <span class="hljs-variable">$login_session</span>-&gt;get_user();

	<span class="hljs-keyword">if</span>(!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$user</span>)){

		<span class="hljs-keyword">echo</span> <span class="hljs-string">"USER: "</span>.<span class="hljs-variable">$user</span>, <span class="hljs-string">"&lt;br/&gt;"</span>;
		<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br&gt;&lt;a href=\"/auth/logout.php\"&gt;Logout&lt;/a&gt;&lt;br/&gt;"</span>;
	}
	<span class="hljs-keyword">else</span>{
		<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;a href=\"/auth/login.php\"&gt;Login&lt;/a&gt;&lt;br/&gt;"</span>;
	}
<span class="hljs-meta">?&gt;</span>
&lt;/body&gt;
&lt;/html&gt;
</code></pre><p><img src="https://i.imgur.com/3tpjtZs.png" alt="" loading="lazy"></p><h3 id="Update" data-id="Update"><a class="anchor hidden-xs" href="#Update" title="Update"><span class="octicon octicon-link"></span></a><span>Update</span></h3><p><span>Update the dinner table is simple. We can directly update the name column by id.</span></p><pre><code class="php hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_update_dinner</span>(<span class="hljs-params"><span class="hljs-variable">$id</span>, <span class="hljs-variable">$name</span></span>)</span>{
	
	<span class="hljs-variable">$sql</span> = sprintf(<span class="hljs-string">"UPDATE dinner SET name = '%s' WHERE id = %s "</span>, <span class="hljs-variable">$name</span>, <span class="hljs-variable">$id</span>);
	<span class="hljs-keyword">$this</span>-&gt;conn-&gt;query(<span class="hljs-variable">$sql</span>);
}
</code></pre><p><span>To rebulit the many-to-many relation without recreate every tag. We delete all dinner-tag dependency by first and and the dependency  one by one later.</span></p><pre><code class="php hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_delete_dinner_tag_with_dinnerID</span>(<span class="hljs-params"><span class="hljs-variable">$dinner</span></span>)</span>{

	<span class="hljs-variable">$sql</span> = sprintf(<span class="hljs-string">"DELETE FROM dinner_tag WHERE dinner= <span class="hljs-subst">$dinner</span>"</span>);
	<span class="hljs-keyword">$this</span>-&gt;conn-&gt;query(<span class="hljs-variable">$sql</span>);
}
</code></pre><p><span>Here we use </span><code>foreach</code><span> in tags array to create dinner-tag relation.</span></p><pre><code class="php hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">update_dinner</span>(<span class="hljs-params"><span class="hljs-variable">$data</span></span>)</span>{
	
	<span class="hljs-variable">$id</span> = <span class="hljs-variable">$data</span>[<span class="hljs-string">"id"</span>];
	<span class="hljs-variable">$tags</span> = <span class="hljs-variable">$data</span>[<span class="hljs-string">"tags"</span>];
	<span class="hljs-variable">$dinner_name</span> = <span class="hljs-variable">$data</span>[<span class="hljs-string">"name"</span>];
	
	<span class="hljs-keyword">$this</span>-&gt;_update_dinner(<span class="hljs-variable">$id</span>, <span class="hljs-variable">$dinner_name</span>);
	<span class="hljs-keyword">$this</span>-&gt;_delete_dinner_tag_with_dinnerID(<span class="hljs-variable">$id</span>);
	
	<span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$tags</span> <span class="hljs-keyword">as</span> &amp;<span class="hljs-variable">$tag</span>){
	
		<span class="hljs-variable">$tag_id</span> = <span class="hljs-keyword">$this</span>-&gt;check_and_insert_tag(<span class="hljs-variable">$tag</span>);		
		<span class="hljs-keyword">$this</span>-&gt;_insert_dinner_tag(<span class="hljs-variable">$id</span>, <span class="hljs-variable">$tag_id</span>);
	}
}
</code></pre><p><span>we can add update &amp; delete button in </span><code>dinner/index.php</code></p><pre><code class="php hljs"><span class="hljs-variable">$delete_button</span> = sprintf(<span class="hljs-string">'&lt;a href="/dinner/delete.php?id=%s"&gt;Delete&lt;/a&gt;'</span>, <span class="hljs-variable">$d</span>-&gt;id);
<span class="hljs-variable">$update_button</span> = sprintf(<span class="hljs-string">'&lt;a href="/dinner/update.php?id=%s"&gt;Update&lt;/a&gt;'</span>, <span class="hljs-variable">$d</span>-&gt;id);
</code></pre><p><span>To update the dinner data, we need the user id match the author’s id to authenticate this operation.</span><br>
<span>If </span><code>$dinner_uid != $user_id</code><span> we return </span><code>NOT AUTHENTICATED</code><span> message.</span></p><pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span>

	<span class="hljs-keyword">include</span> <span class="hljs-string">'dinner.php'</span>;
	<span class="hljs-keyword">include</span> <span class="hljs-string">'../auth/session.php'</span>;
	<span class="hljs-keyword">include_once</span> <span class="hljs-string">'../utils/utils.php'</span>;
	
	<span class="hljs-variable">$login_session</span> = <span class="hljs-keyword">new</span> Login_Session();
	<span class="hljs-keyword">if</span>(<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$login_session</span>-&gt;get_user())){
	
		redirect(<span class="hljs-string">"/auth/login.php"</span>);
	}
	
	<span class="hljs-variable">$user</span> = <span class="hljs-variable">$login_session</span>-&gt;get_user();
	<span class="hljs-variable">$user_id</span> = <span class="hljs-variable">$login_session</span>-&gt;get_user_id();
	<span class="hljs-variable">$dinner</span> = <span class="hljs-keyword">new</span> Dinner(); 
		
	<span class="hljs-variable">$id</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'id'</span>] ?? <span class="hljs-literal">null</span>;
	<span class="hljs-variable">$valid_dinner_id</span> = <span class="hljs-literal">False</span>;
	<span class="hljs-variable">$status_msg</span> = <span class="hljs-string">""</span>;
	
	  

	<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$id</span>) <span class="hljs-keyword">and</span> isInteger(<span class="hljs-variable">$id</span>) ){

		<span class="hljs-variable">$dinner_by_id</span> = <span class="hljs-variable">$dinner</span>-&gt;_get_dinner(<span class="hljs-variable">$id</span>);
		<span class="hljs-keyword">if</span>(<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$dinner_by_id</span>)){
	
			<span class="hljs-variable">$status_msg</span> = <span class="hljs-string">"DINNER NOT FOUND"</span>;
		}<span class="hljs-keyword">else</span>{

			<span class="hljs-variable">$dinner_uid</span> = <span class="hljs-variable">$dinner_by_id</span>[<span class="hljs-string">"uid"</span>];
			<span class="hljs-keyword">if</span>(<span class="hljs-variable">$dinner_uid</span> != <span class="hljs-variable">$user_id</span>){

				<span class="hljs-variable">$status_msg</span> = <span class="hljs-string">"NOT AUTHENTICATED"</span>;
			}<span class="hljs-keyword">else</span>{

				<span class="hljs-variable">$dinner_uname</span> = <span class="hljs-variable">$dinner_by_id</span>[<span class="hljs-string">"username"</span>];
				<span class="hljs-variable">$dinner_name</span> = <span class="hljs-variable">$dinner_by_id</span>[<span class="hljs-string">"name"</span>];
				<span class="hljs-variable">$dinner_tags</span> = <span class="hljs-variable">$dinner</span>-&gt;get_tags(<span class="hljs-variable">$id</span>);

				<span class="hljs-variable">$dinner_tags_string</span> = implode(<span class="hljs-string">", "</span>, <span class="hljs-variable">$dinner_tags</span>);
				<span class="hljs-keyword">echo</span> <span class="hljs-variable">$dinner_uid</span>, <span class="hljs-string">" "</span>, <span class="hljs-variable">$dinner_uname</span>;
			}
		}
	}<span class="hljs-keyword">else</span>{
		<span class="hljs-variable">$status_msg</span> = <span class="hljs-string">"NOT VALID"</span>;
	}
		<span class="hljs-keyword">echo</span> <span class="hljs-variable">$status_msg</span>;
<span class="hljs-meta">?&gt;</span>

  

&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Update Dinner&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;UPDATE!&lt;/h1&gt;
	&lt;div&gt;
		&lt;a href=<span class="hljs-string">"/dinner/index.php"</span>&gt;BACK&lt;/a&gt;
	&lt;/div&gt;
	&lt;form action=<span class="hljs-string">"update.php"</span> method=<span class="hljs-string">"post"</span>&gt;
		&lt;input type=<span class="hljs-string">"hidden"</span> name=<span class="hljs-string">"id"</span> value=<span class="hljs-string">"&lt;?php echo <span class="hljs-subst">$id</span> ?? "</span><span class="hljs-string">";?&gt;"</span>&gt;
		&lt;div&gt;
			&lt;span&gt;Dinner name &lt;/span&gt;&lt;input type=<span class="hljs-string">"text"</span> name=<span class="hljs-string">"name"</span> value=<span class="hljs-string">"&lt;?php echo <span class="hljs-subst">$dinner_name</span> ?? "</span><span class="hljs-string">";?&gt;"</span> required&gt;
		&lt;/div&gt;

		&lt;div&gt;
			&lt;span&gt;Tages &lt;/span&gt;&lt;input type=<span class="hljs-string">"text"</span> name=<span class="hljs-string">"tags"</span> value=<span class="hljs-string">"&lt;?php echo <span class="hljs-subst">$dinner_tags_string</span> ?? "</span><span class="hljs-string">";?&gt;"</span>&gt;
		&lt;/div&gt;
		&lt;div&gt;
			&lt;span&gt;Author &lt;/span&gt;
		&lt;/div&gt;
		&lt;button type=<span class="hljs-string">"submit"</span> name=<span class="hljs-string">"submit"</span>&gt;Submit&lt;/button&gt;

	&lt;/form&gt;

<span class="hljs-meta">&lt;?php</span>

	<span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;h1&gt;Hi! User : "</span>. <span class="hljs-variable">$user</span>. <span class="hljs-string">" with id : "</span>. <span class="hljs-variable">$user_id</span> .<span class="hljs-string">"&lt;/h1&gt;"</span>;
	<span class="hljs-keyword">if</span> (!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_POST</span>)){

		<span class="hljs-variable">$tags</span> = explode(<span class="hljs-string">","</span>, <span class="hljs-variable">$_POST</span>[<span class="hljs-string">"tags"</span>]);
		<span class="hljs-variable">$tags</span> = array_map(<span class="hljs-string">'trim'</span>, <span class="hljs-variable">$tags</span>);

		<span class="hljs-variable">$data</span> = <span class="hljs-keyword">array</span>(
			<span class="hljs-string">'id'</span> =&gt; <span class="hljs-variable">$_POST</span>[<span class="hljs-string">'id'</span>],
			<span class="hljs-string">'name'</span> =&gt; <span class="hljs-variable">$_POST</span>[<span class="hljs-string">"name"</span>],
			<span class="hljs-string">'tags'</span> =&gt; <span class="hljs-variable">$tags</span>,
		);

		<span class="hljs-variable">$dinner</span>-&gt;update_dinner(<span class="hljs-variable">$data</span>);
		meta_redirect(<span class="hljs-string">"/dinner/index.php"</span>);

	}

<span class="hljs-meta">?&gt;</span>
&lt;/body&gt;
&lt;/html&gt;
</code></pre><p><img src="https://i.imgur.com/dxh6GZd.png" alt="" loading="lazy"></p><h3 id="Delete" data-id="Delete"><a class="anchor hidden-xs" href="#Delete" title="Delete"><span class="octicon octicon-link"></span></a><span>Delete</span></h3><p><span>To delete a dinner row is as simple as update. We can just delete the row by id and deal with the relation later.</span></p><pre><code class="php hljs"><span class="hljs-comment">// INSERT INTO dinner (name, author) VALUES ("TO_BE_DELETED", 3) ;</span>
<span class="hljs-comment">// $dinner is dinner id</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_delete_dinner</span>(<span class="hljs-params"><span class="hljs-variable">$dinner</span></span>)</span>{

	<span class="hljs-variable">$sql</span> = sprintf(<span class="hljs-string">"DELETE FROM dinner WHERE id = <span class="hljs-subst">$dinner</span>"</span>);
	<span class="hljs-keyword">$this</span>-&gt;conn-&gt;query(<span class="hljs-variable">$sql</span>);
}
</code></pre><pre><code class="php hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">delete_dinner</span>(<span class="hljs-params"><span class="hljs-variable">$data</span></span>)</span>{

	<span class="hljs-variable">$user</span> = <span class="hljs-variable">$data</span>[<span class="hljs-string">"user"</span>];
	<span class="hljs-variable">$dinner</span> = <span class="hljs-variable">$data</span>[<span class="hljs-string">"dinner"</span>];

	<span class="hljs-variable">$result_dic</span> = <span class="hljs-keyword">array</span>();
	<span class="hljs-variable">$dinner_by_id</span> = <span class="hljs-keyword">$this</span>-&gt;_get_dinner(<span class="hljs-variable">$dinner</span>);
	<span class="hljs-variable">$dinner_uid</span> = <span class="hljs-variable">$dinner_by_id</span>[<span class="hljs-string">"uid"</span>] ?? <span class="hljs-literal">null</span>;

	<span class="hljs-keyword">if</span>(<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$dinner_by_id</span>)){

		<span class="hljs-variable">$result_dic</span>[<span class="hljs-string">"status"</span>] = <span class="hljs-string">"DINNER not found"</span>;
	}<span class="hljs-keyword">else</span>{

		<span class="hljs-keyword">if</span> (<span class="hljs-variable">$dinner_uid</span> == <span class="hljs-variable">$user</span>){
	
			<span class="hljs-keyword">$this</span>-&gt;_delete_dinner(<span class="hljs-variable">$dinner</span>);
			<span class="hljs-variable">$result_dic</span>[<span class="hljs-string">"status"</span>] = <span class="hljs-string">"successful"</span>;
		}<span class="hljs-keyword">else</span>{

			<span class="hljs-variable">$result_dic</span>[<span class="hljs-string">"status"</span>] = <span class="hljs-string">"permission deny"</span>;
		}
	}

	<span class="hljs-variable">$response_json</span> = json_encode(<span class="hljs-variable">$result_dic</span>, JSON_UNESCAPED_UNICODE);
	<span class="hljs-keyword">return</span> <span class="hljs-variable">$response_json</span>;
}
</code></pre><pre><code class="php hljs"><span class="hljs-meta">&lt;?php</span>

	<span class="hljs-keyword">include_once</span> <span class="hljs-string">'../utils/utils.php'</span>;
	<span class="hljs-keyword">include_once</span> <span class="hljs-string">'../auth/session.php'</span>;
	<span class="hljs-keyword">include_once</span> <span class="hljs-string">'dinner.php'</span>;

	<span class="hljs-variable">$login_session</span> = <span class="hljs-keyword">new</span> Login_Session();
	<span class="hljs-variable">$dinner</span> = <span class="hljs-keyword">new</span> Dinner();

	<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'id'</span>]) <span class="hljs-keyword">and</span> isInteger(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'id'</span>]) ){
		<span class="hljs-variable">$id</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'id'</span>];
		<span class="hljs-variable">$user_id</span> = <span class="hljs-variable">$login_session</span>-&gt;get_user_id();  

		<span class="hljs-variable">$data</span> = <span class="hljs-keyword">array</span>(

			<span class="hljs-string">'dinner'</span> =&gt; <span class="hljs-variable">$id</span>,
			<span class="hljs-string">'user'</span> =&gt; <span class="hljs-variable">$user_id</span>
		);
		<span class="hljs-variable">$decoded_response</span> = json_decode(<span class="hljs-variable">$dinner</span>-&gt;delete_dinner(<span class="hljs-variable">$data</span>));
		<span class="hljs-variable">$response</span> = <span class="hljs-variable">$decoded_response</span>-&gt;status;
	}<span class="hljs-keyword">else</span>{
	
		<span class="hljs-variable">$response</span> = <span class="hljs-string">"Invalid ID"</span>;
	}
	<span class="hljs-variable">$uri_with_parameter</span> = sprintf(<span class="hljs-string">"/dinner/index.php?response=%s"</span>, <span class="hljs-variable">$response</span>);
	meta_redirect(<span class="hljs-variable">$uri_with_parameter</span>);
<span class="hljs-meta">?&gt;</span>
</code></pre><p><span>Because we redirect to dinner index page for all response. So we pass the response message as parameter, for exmaple, </span><code>/dinner/index.php?response="permission deny"</code></p><p><span>We still need to check the current user is match to author’s user id or not to confirm this user has the permission to delete.</span><br>
<img src="https://i.imgur.com/D7s6oFL.png" alt="" loading="lazy"></p></div>
    <div class="ui-toc dropup unselectable hidden-print" style="display:none;">
        <div class="pull-right dropdown">
            <a id="tocLabel" class="ui-toc-label btn btn-default" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false" title="Table of content">
                <i class="fa fa-bars"></i>
            </a>
            <ul id="ui-toc" class="ui-toc-dropdown dropdown-menu" aria-labelledby="tocLabel">
                <div class="toc"><ul class="nav">
<li><a href="#Database-System-Term-Project" title="Database System Term Project">Database System Term Project</a><ul class="nav">
<li><a href="#Intro" title="Intro">Intro</a></li>
</ul>
</li>
<li><a href="#Setting-up-environment" title="Setting up environment">Setting up environment</a><ul class="nav">
<li><a href="#Basic-PHP-with-docker" title="Basic PHP with docker">Basic PHP with docker</a></li>
<li><a href="#Build-our-mysql-environment-through-docker-expose" title="Build our mysql environment through docker-expose">Build our mysql environment through docker-expose</a></li>
<li><a href="#Add-phpmyadmin-to-the-environment-and-testing-SQL-queries" title="Add phpmyadmin to the environment and testing SQL queries">Add phpmyadmin to the environment and testing SQL queries</a></li>
</ul>
</li>
<li><a href="#Constructing-PHP-part" title="Constructing PHP part">Constructing PHP part</a><ul class="nav">
<li><a href="#Auth--Database" title="Auth : Database">Auth : Database</a><ul class="nav">
<li><a href="#Database-with-user-data" title="Database with user data">Database with user data</a></li>
</ul>
</li>
<li><a href="#Auth--Register" title="Auth : Register">Auth : Register</a><ul class="nav">
<li><a href="#Basic-form-and-POST" title="Basic form and POST">Basic form and POST</a></li>
<li><a href="#Check-with-field-data" title="Check with field data">Check with field data</a></li>
<li><a href="#Check-exsitance-of-data-in-database" title="Check exsitance of data in database">Check exsitance of data in database</a></li>
<li><a href="#Provide-basic-security-of-password-with-hash" title="Provide basic security of password with hash">Provide basic security of password with hash</a></li>
</ul>
</li>
<li><a href="#Auth--Login" title="Auth : Login">Auth : Login</a><ul class="nav">
<li><a href="#A-basic-Login-page" title="A basic Login page">A basic Login page</a></li>
<li><a href="#Verify-with-hashed-password" title="Verify with hashed password">Verify with hashed password</a></li>
<li><a href="#Sessions-to-stay-login" title="Sessions to stay login">Sessions to stay login</a></li>
<li><a href="#Redirect-page-by-login-session" title="Redirect page by login session">Redirect page by login session</a></li>
<li><a href="#To-prevent-SQL-injections" title="To prevent SQL injections">To prevent SQL injections</a></li>
</ul>
</li>
<li><a href="#Dinner-CRUD" title="Dinner CRUD">Dinner CRUD</a><ul class="nav">
<li><a href="#Dinner-amp-Tag-Schema" title="Dinner &amp; Tag Schema">Dinner &amp; Tag Schema</a></li>
<li><a href="#A-basic-Dinner-Object" title="A basic Dinner Object">A basic Dinner Object</a></li>
<li><a href="#Create" title="Create">Create</a></li>
<li><a href="#Read" title="Read">Read</a></li>
<li><a href="#Update" title="Update">Update</a></li>
<li><a href="#Delete" title="Delete">Delete</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div><div class="toc-menu"><a class="expand-toggle" href="#">全部展開</a><a class="back-to-top" href="#">回到頂部</a><a class="go-to-bottom" href="#">移至底部</a></div>
            </ul>
        </div>
    </div>
    <div id="ui-toc-affix" class="ui-affix-toc ui-toc-dropdown unselectable hidden-print" data-spy="affix" style="top:17px;display:none;" null null>
        <div class="toc"><ul class="nav">
<li><a href="#Database-System-Term-Project" title="Database System Term Project">Database System Term Project</a><ul class="nav">
<li><a href="#Intro" title="Intro">Intro</a></li>
</ul>
</li>
<li><a href="#Setting-up-environment" title="Setting up environment">Setting up environment</a><ul class="nav">
<li><a href="#Basic-PHP-with-docker" title="Basic PHP with docker">Basic PHP with docker</a></li>
<li><a href="#Build-our-mysql-environment-through-docker-expose" title="Build our mysql environment through docker-expose">Build our mysql environment through docker-expose</a></li>
<li><a href="#Add-phpmyadmin-to-the-environment-and-testing-SQL-queries" title="Add phpmyadmin to the environment and testing SQL queries">Add phpmyadmin to the environment and testing SQL queries</a></li>
</ul>
</li>
<li><a href="#Constructing-PHP-part" title="Constructing PHP part">Constructing PHP part</a><ul class="nav">
<li><a href="#Auth--Database" title="Auth : Database">Auth : Database</a><ul class="nav">
<li><a href="#Database-with-user-data" title="Database with user data">Database with user data</a></li>
</ul>
</li>
<li><a href="#Auth--Register" title="Auth : Register">Auth : Register</a><ul class="nav">
<li><a href="#Basic-form-and-POST" title="Basic form and POST">Basic form and POST</a></li>
<li><a href="#Check-with-field-data" title="Check with field data">Check with field data</a></li>
<li><a href="#Check-exsitance-of-data-in-database" title="Check exsitance of data in database">Check exsitance of data in database</a></li>
<li><a href="#Provide-basic-security-of-password-with-hash" title="Provide basic security of password with hash">Provide basic security of password with hash</a></li>
</ul>
</li>
<li><a href="#Auth--Login" title="Auth : Login">Auth : Login</a><ul class="nav">
<li><a href="#A-basic-Login-page" title="A basic Login page">A basic Login page</a></li>
<li><a href="#Verify-with-hashed-password" title="Verify with hashed password">Verify with hashed password</a></li>
<li><a href="#Sessions-to-stay-login" title="Sessions to stay login">Sessions to stay login</a></li>
<li><a href="#Redirect-page-by-login-session" title="Redirect page by login session">Redirect page by login session</a></li>
<li><a href="#To-prevent-SQL-injections" title="To prevent SQL injections">To prevent SQL injections</a></li>
</ul>
</li>
<li><a href="#Dinner-CRUD" title="Dinner CRUD">Dinner CRUD</a><ul class="nav">
<li><a href="#Dinner-amp-Tag-Schema" title="Dinner &amp; Tag Schema">Dinner &amp; Tag Schema</a></li>
<li><a href="#A-basic-Dinner-Object" title="A basic Dinner Object">A basic Dinner Object</a></li>
<li><a href="#Create" title="Create">Create</a></li>
<li><a href="#Read" title="Read">Read</a></li>
<li><a href="#Update" title="Update">Update</a></li>
<li><a href="#Delete" title="Delete">Delete</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div><div class="toc-menu"><a class="expand-toggle" href="#">全部展開</a><a class="back-to-top" href="#">回到頂部</a><a class="go-to-bottom" href="#">移至底部</a></div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gist-embed/2.6.0/gist-embed.min.js" integrity="sha256-KyF2D6xPIJUW5sUDSs93vWyZm+1RzIpKCexxElmxl8g=" crossorigin="anonymous" defer></script>
    <script>
        var markdown = $(".markdown-body");
        //smooth all hash trigger scrolling
        function smoothHashScroll() {
            var hashElements = $("a[href^='#']").toArray();
            for (var i = 0; i < hashElements.length; i++) {
                var element = hashElements[i];
                var $element = $(element);
                var hash = element.hash;
                if (hash) {
                    $element.on('click', function (e) {
                        // store hash
                        var hash = this.hash;
                        if ($(hash).length <= 0) return;
                        // prevent default anchor click behavior
                        e.preventDefault();
                        // animate
                        $('body, html').stop(true, true).animate({
                            scrollTop: $(hash).offset().top
                        }, 100, "linear", function () {
                            // when done, add hash to url
                            // (default click behaviour)
                            window.location.hash = hash;
                        });
                    });
                }
            }
        }

        smoothHashScroll();
        var toc = $('.ui-toc');
        var tocAffix = $('.ui-affix-toc');
        var tocDropdown = $('.ui-toc-dropdown');
        //toc
        tocDropdown.click(function (e) {
            e.stopPropagation();
        });

        var enoughForAffixToc = true;

        function generateScrollspy() {
            $(document.body).scrollspy({
                target: ''
            });
            $(document.body).scrollspy('refresh');
            if (enoughForAffixToc) {
                toc.hide();
                tocAffix.show();
            } else {
                tocAffix.hide();
                toc.show();
            }
            $(document.body).scroll();
        }

        function windowResize() {
            //toc right
            var paddingRight = parseFloat(markdown.css('padding-right'));
            var right = ($(window).width() - (markdown.offset().left + markdown.outerWidth() - paddingRight));
            toc.css('right', right + 'px');
            //affix toc left
            var newbool;
            var rightMargin = (markdown.parent().outerWidth() - markdown.outerWidth()) / 2;
            //for ipad or wider device
            if (rightMargin >= 133) {
                newbool = true;
                var affixLeftMargin = (tocAffix.outerWidth() - tocAffix.width()) / 2;
                var left = markdown.offset().left + markdown.outerWidth() - affixLeftMargin;
                tocAffix.css('left', left + 'px');
            } else {
                newbool = false;
            }
            if (newbool != enoughForAffixToc) {
                enoughForAffixToc = newbool;
                generateScrollspy();
            }
        }
        $(window).resize(function () {
            windowResize();
        });
        $(document).ready(function () {
            windowResize();
            generateScrollspy();
        });

        //remove hash
        function removeHash() {
            window.location.hash = '';
        }

        var backtotop = $('.back-to-top');
        var gotobottom = $('.go-to-bottom');

        backtotop.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            if (scrollToTop)
                scrollToTop();
            removeHash();
        });
        gotobottom.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            if (scrollToBottom)
                scrollToBottom();
            removeHash();
        });

        var toggle = $('.expand-toggle');
        var tocExpand = false;

        checkExpandToggle();
        toggle.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            tocExpand = !tocExpand;
            checkExpandToggle();
        })

        function checkExpandToggle () {
            var toc = $('.ui-toc-dropdown .toc');
            var toggle = $('.expand-toggle');
            if (!tocExpand) {
                toc.removeClass('expand');
                toggle.text('Expand all');
            } else {
                toc.addClass('expand');
                toggle.text('Collapse all');
            }
        }

        function scrollToTop() {
            $('body, html').stop(true, true).animate({
                scrollTop: 0
            }, 100, "linear");
        }

        function scrollToBottom() {
            $('body, html').stop(true, true).animate({
                scrollTop: $(document.body)[0].scrollHeight
            }, 100, "linear");
        }
    </script>
</body>

</html>
